<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy 21st Birthday!</title>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.10.7/dist/index.umd.js"></script>
    
    <style>
        /* ==================== æ¨£å¼å€ (CSS) ==================== */
        :root { 
            --accent: #ff4d6d;        
            --cream: #fff5e1;         
            --cake-base: #f5c096;     
            --plate: #f0f0f0;         
            --envelope: #ff758c;      
        }
        body {
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            font-family: 'Noto Serif TC', 'Microsoft JhengHei', serif; /* æ›å€‹å­—é«”æ›´æœ‰è³ªæ„Ÿ */
            color: #fff; overflow: hidden; background: #000;
        }

        /* èƒŒæ™¯å½±ç‰‡ */
        #bg-video {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            object-fit: cover; z-index: -1;
            filter: brightness(0.4); opacity: 0; transition: opacity 2.5s ease-in;
        }
        .fireworks-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; pointer-events: none; }

        /* ç£¨ç ‚ç»ç’ƒå¡ç‰‡ (Glassmorphism) */
        .card {
            text-align: center; 
            background: rgba(255, 255, 255, 0.1); /* æ›´é€šé€çš„ç™½ */
            padding: 40px; 
            border-radius: 20px;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); /* å¼·åŠ›æ¨¡ç³Š */
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); 
            width: 85%; max-width: 420px; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            z-index: 10; 
            transition: all 0.5s ease;
            position: absolute; /* è®“å ´æ™¯é‡ç–Šï¼Œæ–¹ä¾¿åˆ‡æ› */
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        
        .hidden { 
            opacity: 0; 
            pointer-events: none; 
            transform: translate(-50%, -40%) scale(0.95); /* éš±è—æ™‚ç¨å¾®å¾€ä¸Šæµ®ä¸¦ç¸®å° */
        } 

        /* å…ƒä»¶æ¨£å¼ */
        h2 { font-weight: 500; letter-spacing: 2px; margin-bottom: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        p { font-size: 1.1rem; line-height: 1.6; color: #eee; }
        
        input { 
            padding: 12px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.3); 
            width: 70%; margin-bottom: 20px; text-align: center; font-size: 1.2rem; outline: none; 
            background: rgba(0,0,0,0.3); color: #fff; transition: 0.3s;
        }
        input:focus { background: rgba(0,0,0,0.5); border-color: var(--accent); }

        .btn { 
            padding: 12px 30px; border-radius: 50px; border: none; 
            background: linear-gradient(135deg, var(--accent), #ff758c); 
            color: white; cursor: pointer; font-size: 1rem; transition: 0.3s; margin: 10px; font-weight: bold; 
            box-shadow: 0 4px 15px rgba(255, 77, 109, 0.4);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 77, 109, 0.6); }
        .btn-secondary { background: rgba(255,255,255,0.2); box-shadow: none; } /* æ¬¡è¦æŒ‰éˆ• */

        /* æƒ¡ææŒ‰éˆ•å°ˆç”¨ */
        #btn-no { position: relative; transition: all 0.2s ease; }

        .typing-area { font-size: 1.15rem; line-height: 1.8; margin-bottom: 30px; text-align: left; min-height: 120px; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); }

        /* è›‹ç³•èˆ‡å‹•ç•« (ä¿æŒä¸è®Š) */
        .cake-stage { position: relative; height: 220px; width: 250px; margin: 0 auto 20px auto; }
        .cake-part { position: absolute; opacity: 0; left: 50%; transform: translateX(-50%); }
        #plate { bottom: 0; width: 240px; height: 15px; background: var(--plate); border-radius: 50%; box-shadow: 0 5px 10px rgba(0,0,0,0.3); }
        #cake-bottom { bottom: 15px; width: 200px; height: 70px; background: var(--cake-base); border-radius: 10px 10px 5px 5px; box-shadow: inset -10px 0 20px rgba(0,0,0,0.1); }
        #cake-middle { bottom: 80px; width: 200px; height: 10px; background: #7a4b36; border-radius: 2px; }
        #cake-top { bottom: 85px; width: 200px; height: 60px; background: #ffbcd9; border-radius: 15px 15px 5px 5px; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.05); z-index: 2; }
        #cake-top::before { content: ''; position: absolute; top: 50px; left: 15px; width: 20px; height: 25px; background: #ffbcd9; border-radius: 0 0 20px 20px; box-shadow: 40px 0 0 #ffbcd9, 80px 5px 0 #ffbcd9, 120px 0 0 #ffbcd9, 150px 8px 0 #ffbcd9; }
        .cherry { width: 20px; height: 20px; background: #d90429; border-radius: 50%; position: absolute; top: -10px; z-index: 3; box-shadow: inset -2px -2px 5px rgba(0,0,0,0.3); }
        #candle { bottom: 140px; width: 12px; height: 40px; background: repeating-linear-gradient(45deg, #fff, #fff 4px, #74c0fc 4px, #74c0fc 8px); z-index: 1; border-radius: 2px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        #flame { width: 14px; height: 24px; background: #ffcc00; border-radius: 50% 50% 20% 20%; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); box-shadow: 0 0 15px #ff6600, 0 0 30px #ffcc00; animation: flicker 0.4s infinite alternate; display: none; }

        .envelope-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 300px; height: 200px; z-index: 100; cursor: pointer; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .envelope-body { position: absolute; bottom: 0; width: 100%; height: 100%; background: var(--envelope); border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 2; overflow: hidden; }
        .envelope-flap { position: absolute; top: 0; left: 0; width: 0; height: 0; border-left: 150px solid transparent; border-right: 150px solid transparent; border-top: 110px solid #ff8fa3; transform-origin: top; transition: transform 0.6s ease; z-index: 4; }
        .envelope-pocket { position: absolute; bottom: 0; left: 0; width: 0; height: 0; border-left: 150px solid var(--envelope); border-right: 150px solid var(--envelope); border-bottom: 100px solid transparent; border-top: 100px solid transparent; z-index: 3; }
        .letter { position: absolute; bottom: 0; left: 20px; width: 260px; height: 250px; background: #fff; padding: 20px; box-sizing: border-box; border-radius: 5px; color: #333; font-size: 1rem; line-height: 1.6; text-align: left; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); transition: transform 0.8s ease; z-index: 1; transform: translateY(100px); }
        
        .envelope-container.open .envelope-flap { transform: rotateX(180deg); z-index: 1; }
        .envelope-container.open .letter { transform: translateY(-120px); z-index: 5; }

        .animate #plate { animation: bounceInUp 0.8s ease-out forwards; }
        .animate #cake-bottom { animation: bounceInUp 0.8s ease-out 0.3s forwards; }
        .animate #cake-middle { animation: bounceInUp 0.8s ease-out 0.5s forwards; }
        .animate #cake-top { animation: dropDown 0.8s ease-out 0.8s forwards; }
        .animate .cherry { animation: dropDown 0.6s ease-out 1.2s forwards; }
        .animate #candle { animation: dropDown 0.6s ease-out 1.4s forwards; }
        @keyframes bounceInUp { 0% { opacity: 0; transform: translate(-50%, 100px); } 60% { opacity: 1; transform: translate(-50%, -10px); } 100% { opacity: 1; transform: translate(-50%, 0); } }
        @keyframes dropDown { 0% { opacity: 0; transform: translate(-50%, -100px); } 60% { opacity: 1; transform: translate(-50%, 10px); } 100% { opacity: 1; transform: translate(-50%, 0); } }
        @keyframes flicker { from { opacity: 0.85; transform: translateX(-50%) scale(0.9); } to { opacity: 1; transform: translateX(-50%) scale(1.1); } }
    </style>
</head>
<body>
    <div class="fireworks-container"></div>
    <video muted loop playsinline id="bg-video"><source src="bgvideo.mp4" type="video/mp4"></video>
    <audio id="introMusic" loop><source src="bg2song.mp3" type="audio/mpeg"></audio>
    <audio id="cakeMusic" loop><source src="bgsong.mp3" type="audio/mpeg"></audio>

    <div id="scene-login" class="card">
        <h2>ğŸ”’ é€šè¡Œè­‰é©—è­‰</h2>
        <p>è«‹è¼¸å…¥æœ¬æ¬¡èˆªç­ä»£ç¢¼</p>
        <input type="password" id="pw-input" placeholder="0121">
        <br><button class="btn" onclick="checkPassword()">ç¢ºèªç™»æ©Ÿ</button>
    </div>

    <div id="scene-fun" class="card hidden">
        <h2 id="fun-question">æº–å‚™å¥½æ¥æ”¶ 21 æ­²çš„ç¥ç¦äº†å—ï¼Ÿ</h2>
        <div style="margin-top: 30px;">
            <button class="btn" onclick="nextScene('scene-fun', 'scene-text'); startTyping();">æº–å‚™å¥½äº†ï¼</button>
            <button class="btn btn-secondary" id="btn-no" onmouseover="moveButton(this)" onclick="moveButton(this)">é‚„æ²’...</button>
        </div>
    </div>

    <div id="scene-text" class="card hidden">
        <h2>æˆ‘æƒ³å°å¦³èªª...</h2>
        <div id="typing-text" class="typing-area"></div>
        <button id="btn-next-2" class="btn hidden" onclick="nextScene('scene-text', 'scene-cake')">ç¹¼çºŒæ—…ç¨‹</button>
    </div>

    <div id="scene-cake" class="card hidden">
        <div id="pre-cake-ui">
            <h1 style="margin-bottom: 30px;">è¨±å€‹é¡˜å§ï¼</h1>
            <button class="btn" onclick="startCakeShow()">é»ç‡ƒé©šå–œ</button>
        </div>
        <div class="cake-stage" id="cake-stage">
            <div id="plate" class="cake-part"></div>
            <div id="cake-bottom" class="cake-part"></div>
            <div id="cake-middle" class="cake-part"></div>
            <div id="cake-top" class="cake-part">
                <div class="cherry" style="left: 20px;"></div>
                <div class="cherry" style="left: 90px;"></div>
                <div class="cherry" style="left: 160px;"></div>
            </div>
            <div id="candle" class="cake-part"><div id="flame"></div></div>
        </div>
    </div>

    <div class="envelope-container" id="final-envelope" onclick="openEnvelope()">
        <div class="envelope-flap"></div>
        <div class="envelope-body"></div>
        <div class="letter" id="letter-content"></div>
    </div>

    <script>
        const CONFIG = {
            password: '0121',
            typingText: "é›–ç„¶æˆ‘å€‘é‚„æ²’çœŸæ­£è¦‹éé¢ï¼Œ\nä½†é€™æ®µæ™‚é–“å’Œå¦³èŠå¤©çœŸçš„å¾ˆé–‹å¿ƒã€‚\nåœ¨é€™å€‹ç‰¹åˆ¥çš„æ—¥å­ï¼Œ\næƒ³ç”¨æˆ‘æ­£åœ¨å­¸çš„ç¨‹å¼ï¼Œçµ¦å¦³ä¸€é»ä¸ä¸€æ¨£çš„ç¥ç¦...",
            letterContent: `
                <p><strong>To 21æ­²çš„å¦³ï¼š</strong></p>
                <p>ç”Ÿæ—¥å¿«æ¨‚ï¼ğŸ‰<br>
                è›‹ç³•è¨±å®Œé¡˜äº†å—ï¼Ÿ<br>
                å¸Œæœ›æ–°çš„ä¸€æ­²ï¼Œ<br>
                å¦³èƒ½é‡è¦‹æ›´å¤šç¾å¥½çš„é¢¨æ™¯ã€‚<br>
                ä¸ç®¡æœªä¾†å¦‚ä½•ï¼Œ<br>
                æˆ‘éƒ½åœ¨é€™è£¡æ”¯æŒå¦³ï¼âœ¨</p>
            `,
            fireworksConfig: { intensity: 45, particles: 200, explosion: 10, traceLength: 5, brightness: {min: 60, max: 90}, delay: {min: 15, max: 30} }
        };

        const fireworks = new Fireworks.default(document.querySelector('.fireworks-container'), CONFIG.fireworksConfig);
        document.getElementById('letter-content').innerHTML = CONFIG.letterContent;

        // 1. æª¢æŸ¥å¯†ç¢¼ -> é€²å…¥æƒ¡æç’°ç¯€
        function checkPassword() {
            if (document.getElementById('pw-input').value === CONFIG.password) {
                const video = document.getElementById('bg-video'); video.play(); video.style.opacity = 1;
                document.getElementById('introMusic').play().catch(() => {});
                
                // --- æ”¹æˆé€²å…¥æƒ¡æå ´æ™¯ ---
                nextScene('scene-login', 'scene-fun');
            } else { alert("é€šè¡Œè­‰ç„¡æ•ˆï¼(å¯†ç¢¼éŒ¯èª¤)"); }
        }

        // 2. æƒ¡ææŒ‰éˆ•ç§»å‹•é‚è¼¯
        function moveButton(btn) {
            // éš¨æ©Ÿç”¢ç”Ÿä¸€å€‹æ–°ä½ç½® (ç¯„åœé™åˆ¶åœ¨å¡ç‰‡å…§æ¯”è¼ƒå¥½ï¼Œæˆ–è€…è¢å¹•å…§)
            // é€™è£¡è¨­å®šè®“å®ƒåœ¨è¢å¹•ç¯„åœå…§äº‚è·‘
            const x = Math.random() * (window.innerWidth - 100);
            const y = Math.random() * (window.innerHeight - 50);
            
            // å°‡æŒ‰éˆ•æ”¹ç‚ºçµ•å°å®šä½ï¼Œæ‰èƒ½è‡ªç”±ç§»å‹•
            btn.style.position = 'fixed';
            btn.style.left = x + 'px';
            btn.style.top = y + 'px';
            
            // æ›´æ”¹æ–‡å­—å˜²è«·ä¸€ä¸‹
            const mocks = ["æŠ“ä¸åˆ°~", "å¤ªæ…¢äº†ï¼", "é»æ—é‚Šé‚£å€‹å•¦", "å˜¿å˜¿~"];
            btn.innerText = mocks[Math.floor(Math.random() * mocks.length)];
        }

        // 3. å ´æ™¯åˆ‡æ›å™¨
        function nextScene(currentId, nextId) {
            // è®“èˆŠå ´æ™¯éš±è—
            const current = document.getElementById(currentId);
            current.classList.add('hidden');
            
            // è®“æ–°å ´æ™¯å‡ºç¾
            const next = document.getElementById(nextId);
            next.classList.remove('hidden');
        }

        // 4. æ‰“å­—æ©Ÿ
        function startTyping(){
            const area = document.getElementById('typing-text'); let i=0;
            const text = CONFIG.typingText;
            function type(){
                if(i < text.length){ area.innerHTML += text.charAt(i) === '\n' ? '<br>' : text.charAt(i); i++; setTimeout(type, 100); } 
                else { document.getElementById('btn-next-2').classList.remove('hidden'); }
            } type();
        }

        // 5. è›‹ç³•ç§€
        function startCakeShow() {
            const intro = document.getElementById('introMusic'); intro.pause(); intro.currentTime = 0;
            document.getElementById('cakeMusic').play();

            document.getElementById('pre-cake-ui').style.display = 'none';
            const card = document.querySelector('#scene-cake');
            card.style.background = 'transparent'; card.style.boxShadow = 'none'; card.style.border = 'none'; card.style.backdropFilter = 'none';

            document.getElementById('cake-stage').classList.add('animate');
            
            setTimeout(() => {
                document.getElementById('flame').style.display = 'block';
                fireworks.start(); 
                setTimeout(() => {
                    const env = document.getElementById('final-envelope');
                    env.style.transform = "translate(-50%, -50%) scale(1)";
                }, 3000);
            }, 2000);
        }

        function openEnvelope() { document.getElementById('final-envelope').classList.add('open'); }
    </script>
</body>
</html>
