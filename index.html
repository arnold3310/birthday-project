<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy 21st Birthday!</title>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.10.7/dist/index.umd.js"></script>
    <style>
        :root { --accent: #ff4d6d; --cream: #fff5e1; --cake-base: #f5c096; --plate: #f0f0f0; --envelope-col: #ff758c; }
        body {
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            font-family: 'Microsoft JhengHei', sans-serif; color: #fff; overflow: hidden; background: #000;
        }

        /* èƒŒæ™¯å½±ç‰‡ (é è¨­éš±è—ï¼Œè§£é–å¾Œæµ®ç¾) */
        #bg-video {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            object-fit: cover; z-index: -1;
            filter: brightness(0.4); opacity: 0; transition: opacity 2.5s ease-in;
        }

        .fireworks-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; pointer-events: none; }
        
        /* é€šç”¨å¡ç‰‡æ¨£å¼ (æ¯ä¸€å¹•éƒ½ç”¨é€™å€‹) */
        .card {
            text-align: center; background: rgba(20, 30, 50, 0.75); padding: 40px; border-radius: 20px;
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); width: 85%; max-width: 450px; position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2); z-index: 10; 
            transition: all 0.5s ease;
        }
        
        .hidden { display: none; } /* ç”¨ä¾†éš±è—é‚„æ²’è¼ªåˆ°çš„å ´æ™¯ */
        
        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
        input { padding: 12px; border-radius: 10px; border: none; width: 70%; margin-bottom: 15px; text-align: center; font-size: 1.2rem; outline: none; background: rgba(255,255,255,0.9); color: #333; }
        .btn { padding: 12px 25px; border-radius: 50px; border: none; background: var(--accent); color: white; cursor: pointer; font-size: 1rem; transition: 0.3s; margin: 10px 5px; font-weight: bold; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 77, 109, 0.5); }
        
        /* æ‰“å­—æ©Ÿæ–‡å­—å€ */
        .typing-area { font-size: 1.2rem; line-height: 1.8; margin-bottom: 20px; text-align: left; min-height: 100px; }

        /* ====================
           ğŸ° è›‹ç³•æ¨£å¼
           ==================== */
        .cake-stage { position: relative; height: 220px; width: 250px; margin: 0 auto 20px auto; }
        .cake-part { position: absolute; opacity: 0; left: 50%; transform: translateX(-50%); }
        #plate { bottom: 0; width: 240px; height: 15px; background: var(--plate); border-radius: 50%; box-shadow: 0 5px 10px rgba(0,0,0,0.3); }
        #cake-bottom { bottom: 15px; width: 200px; height: 70px; background: var(--cake-base); border-radius: 10px 10px 5px 5px; box-shadow: inset -10px 0 20px rgba(0,0,0,0.1); }
        #cake-middle { bottom: 80px; width: 200px; height: 10px; background: #7a4b36; border-radius: 2px; }
        #cake-top { bottom: 85px; width: 200px; height: 60px; background: #ffbcd9; border-radius: 15px 15px 5px 5px; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.05); z-index: 2; }
        #cake-top::before { content: ''; position: absolute; top: 50px; left: 15px; width: 20px; height: 25px; background: #ffbcd9; border-radius: 0 0 20px 20px; box-shadow: 40px 0 0 #ffbcd9, 80px 5px 0 #ffbcd9, 120px 0 0 #ffbcd9, 150px 8px 0 #ffbcd9; }
        .cherry { width: 20px; height: 20px; background: #d90429; border-radius: 50%; position: absolute; top: -10px; z-index: 3; box-shadow: inset -2px -2px 5px rgba(0,0,0,0.3); }
        #candle { bottom: 140px; width: 12px; height: 40px; background: repeating-linear-gradient(45deg, #fff, #fff 4px, #74c0fc 4px, #74c0fc 8px); z-index: 1; border-radius: 2px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        #flame { width: 14px; height: 24px; background: #ffcc00; border-radius: 50% 50% 20% 20%; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); box-shadow: 0 0 15px #ff6600, 0 0 30px #ffcc00; animation: flicker 0.4s infinite alternate; display: none; }

        /* ====================
           ğŸ’Œ ä¿¡å°èˆ‡ä¿¡ç´™æ¨£å¼ (å£“è»¸é©šå–œ)
           ==================== */
        .envelope-container { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 300px; height: 200px; z-index: 100; cursor: pointer; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .envelope-body {
            position: absolute; bottom: 0; width: 100%; height: 100%;
            background: var(--envelope-col); border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 2; overflow: hidden;
        }
        /* ä¿¡å°é–‹å£ (ä¸‰è§’å½¢) */
        .envelope-flap {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 150px solid transparent; border-right: 150px solid transparent;
            border-top: 110px solid #ff8fa3; /* ç¨å¾®æ·±ä¸€é»çš„ç²‰è‰² */
            transform-origin: top; transition: transform 0.6s ease; z-index: 4;
        }
        /* ä¿¡å°ä¸‹æ–¹çš„é®æ“‹ä¸‰è§’å½¢ */
        .envelope-pocket {
            position: absolute; bottom: 0; left: 0; width: 0; height: 0;
            border-left: 150px solid var(--envelope-col); border-right: 150px solid var(--envelope-col);
            border-bottom: 100px solid transparent; /* é€™æ¨£æ‰æœƒå½¢æˆ V å­—é–‹å£ */
            border-top: 100px solid transparent;
            z-index: 3;
        }
        /* ä¿¡ç´™ */
        .letter {
            position: absolute; bottom: 0; left: 20px; width: 260px; height: 250px; /* æ¯”ä¿¡å°é«˜ï¼Œæ»‘å‡ºä¾†æ‰å¥½çœ‹ */
            background: #fff; padding: 20px; box-sizing: border-box;
            border-radius: 5px; color: #333; font-size: 1rem; line-height: 1.6; text-align: left;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
            transition: transform 0.8s ease; z-index: 1; transform: translateY(100px); /* åˆå§‹è—åœ¨è£¡é¢ */
        }
        
        /* ä¿¡å°é–‹å•Ÿå‹•ç•«ç‹€æ…‹ */
        .envelope-container.open .envelope-flap { transform: rotateX(180deg); z-index: 1; }
        .envelope-container.open .letter { transform: translateY(-120px); z-index: 5; } /* ä¿¡ç´™æ»‘å‡º */
        
        /* è›‹ç³•å‹•ç•« */
        @keyframes bounceInUp { 0% { opacity: 0; transform: translate(-50%, 100px); } 60% { opacity: 1; transform: translate(-50%, -10px); } 100% { opacity: 1; transform: translate(-50%, 0); } }
        @keyframes dropDown { 0% { opacity: 0; transform: translate(-50%, -100px); } 60% { opacity: 1; transform: translate(-50%, 10px); } 100% { opacity: 1; transform: translate(-50%, 0); } }
        @keyframes flicker { from { opacity: 0.85; transform: translateX(-50%) scale(0.9); } to { opacity: 1; transform: translateX(-50%) scale(1.1); } }

        .animate #plate { animation: bounceInUp 0.8s ease-out forwards; }
        .animate #cake-bottom { animation: bounceInUp 0.8s ease-out 0.3s forwards; }
        .animate #cake-middle { animation: bounceInUp 0.8s ease-out 0.5s forwards; }
        .animate #cake-top { animation: dropDown 0.8s ease-out 0.8s forwards; }
        .animate .cherry { animation: dropDown 0.6s ease-out 1.2s forwards; }
        .animate #candle { animation: dropDown 0.6s ease-out 1.4s forwards; }
    </style>
</head>
<body>

    <div class="fireworks-container"></div>
    <video muted loop playsinline id="bg-video"><source src="bgvideo.mp4" type="video/mp4"></video>
    <audio id="introMusic" loop><source src="bg2song.mp3" type="audio/mpeg"></audio>
    <audio id="cakeMusic" loop><source src="bgsong.mp3" type="audio/mpeg"></audio>

    <div id="scene-1" class="card">
        <h2>ğŸ”’ èº«åˆ†é©—è­‰</h2>
        <p>è«‹è¼¸å…¥å°ˆå±¬å¯†ç¢¼</p>
        <input type="password" id="pw-input">
        <br><button class="btn" onclick="checkPassword()">è§£é–é©šå–œ</button>
    </div>

    <div id="scene-2" class="card hidden">
        <h2>æˆ‘æƒ³å°å¦³èªª...</h2>
        <div id="typing-text" class="typing-area"></div>
        <button id="btn-next-2" class="btn hidden" onclick="nextScene('scene-2', 'scene-cake')">ä¸‹ä¸€æ­¥</button>
    </div>

    <div id="scene-cake" class="card hidden">
        <div id="pre-cake-ui">
            <h1 style="margin-bottom: 30px;">æº–å‚™å¥½äº†å—ï¼Ÿ</h1>
            <button class="btn" onclick="startCakeShow()">é»ç‡ƒé©šå–œ</button>
        </div>

        <div class="cake-stage" id="cake-stage">
            <div id="plate" class="cake-part"></div>
            <div id="cake-bottom" class="cake-part"></div>
            <div id="cake-middle" class="cake-part"></div>
            <div id="cake-top" class="cake-part">
                <div class="cherry" style="left: 20px;"></div>
                <div class="cherry" style="left: 90px;"></div>
                <div class="cherry" style="left: 160px;"></div>
            </div>
            <div id="candle" class="cake-part"><div id="flame"></div></div>
        </div>
    </div>

    <div class="envelope-container" id="final-envelope" onclick="openEnvelope()">
        <div class="envelope-flap"></div>
        <div class="envelope-body"></div>
        <div class="letter">
            <p><strong>To 21æ­²çš„å¦³ï¼š</strong></p>
            <p>ç”Ÿæ—¥å¿«æ¨‚ï¼ğŸ‰<br>
            é€™å°ä¿¡è—åœ¨ç…™ç«ä¹‹å¾Œï¼Œ<br>
            å¸Œæœ›æ–°çš„ä¸€æ­²ï¼Œ<br>
            å¦³èƒ½é‡è¦‹æ›´å¤šç¾å¥½çš„é¢¨æ™¯ã€‚<br>
            ä¸ç®¡æœªä¾†å¦‚ä½•ï¼Œ<br>
            æˆ‘éƒ½åœ¨é€™è£¡æ”¯æŒå¦³ï¼âœ¨</p>
        </div>
    </div>

    <script>
        const correctPw = '0121';
        
        // --- é€™è£¡ä¿®æ”¹ä¸­é–“æƒ³èªªçš„è©± ---
        const heartWords = "é›–ç„¶æˆ‘å€‘é‚„æ²’çœŸæ­£è¦‹éé¢ï¼Œ\nä½†é€™æ®µæ™‚é–“å’Œå¦³èŠå¤©çœŸçš„å¾ˆé–‹å¿ƒã€‚\nåœ¨é€™å€‹ç‰¹åˆ¥çš„æ—¥å­ï¼Œ\næƒ³ç”¨æˆ‘æ­£åœ¨å­¸çš„ç¨‹å¼ï¼Œçµ¦å¦³ä¸€é»ä¸ä¸€æ¨£çš„ç¥ç¦...";
        
        // è¨­å®šé«˜ç´šç…™ç«åƒæ•¸
        const fireworks = new Fireworks.default(document.querySelector('.fireworks-container'), { 
            intensity: 40, particles: 180, friction: 0.96, gravity: 1.2, acceleration: 1.05, 
            explosion: 8, traceLength: 4, traceSpeed: 10, brightness: {min: 60, max: 90},
            hue: {min: 0, max: 360}, delay: {min: 20, max: 40} // é »ç‡æ›´å¿«ï¼Œé¡è‰²æ›´äº®
        });

        // æª¢æŸ¥å¯†ç¢¼
        function checkPassword() {
            if (document.getElementById('pw-input').value === correctPw) {
                const video = document.getElementById('bg-video'); video.play(); video.style.opacity = 1;
                document.getElementById('introMusic').play().catch(() => {});
                
                // é€²å…¥ä¸‹ä¸€å¹•
                nextScene('scene-1', 'scene-2');
                startTyping(); // é–‹å§‹æ‰“å­—
            } else { alert("å¯†ç¢¼éŒ¯èª¤å–”ï¼"); }
        }

        // å ´æ™¯åˆ‡æ›é€šç”¨å‡½å¼
        function nextScene(currentId, nextId) {
            document.getElementById(currentId).classList.add('hidden');
            document.getElementById(nextId).classList.remove('hidden');
        }

        // æ‰“å­—æ©Ÿæ•ˆæœ
        function startTyping(){
            const area = document.getElementById('typing-text'); let i=0;
            function type(){
                if(i<heartWords.length){ area.innerHTML+=heartWords.charAt(i)==='\n'?'<br>':heartWords.charAt(i); i++; setTimeout(type, 100); }
                else{ document.getElementById('btn-next-2').classList.remove('hidden'); }
            } type();
        }

        // è›‹ç³•ç§€ + ç…™ç«
        function startCakeShow() {
            // åˆ‡æ›éŸ³æ¨‚
            const intro = document.getElementById('introMusic'); intro.pause(); intro.currentTime = 0;
            document.getElementById('cakeMusic').play();

            // éš±è—æŒ‰éˆ•ï¼Œè®“èƒŒæ™¯è®Šé€æ˜
            document.getElementById('pre-cake-ui').style.display = 'none';
            const card = document.querySelector('#scene-cake');
            card.style.background = 'transparent'; card.style.boxShadow = 'none'; card.style.border = 'none'; card.style.backdropFilter = 'none';

            // è›‹ç³•å‹•ç•«
            document.getElementById('cake-stage').classList.add('animate');
            
            // é»ç« + ç…™ç« + ä¿¡å°å‡ºç¾
            setTimeout(() => {
                document.getElementById('flame').style.display = 'block';
                fireworks.start(); // å•Ÿå‹•é«˜ç´šç…™ç«
                
                // 3ç§’å¾Œï¼Œä¿¡å°é£›å…¥
                setTimeout(() => {
                    const env = document.getElementById('final-envelope');
                    env.style.transform = "translate(-50%, -50%) scale(1)"; // è®Šå¤§å‡ºç¾
                }, 3000);
                
            }, 2000);
        }

        // æ‰“é–‹ä¿¡å°
        function openEnvelope() {
            document.getElementById('final-envelope').classList.add('open');
        }
    </script>
</body>
</html>
