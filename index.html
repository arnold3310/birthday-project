<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Surprise</title>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.10.7/dist/index.umd.js"></script>
    <style>
        :root { --accent: #ff4d6d; }
        body {
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            font-family: 'Microsoft JhengHei', sans-serif; color: #fff; overflow: hidden; background: #000;
        }
        /* èƒŒæ™¯å½±ç‰‡ */
        #bg-video {
            position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%;
            width: auto; height: auto; z-index: -100; background-size: cover;
            filter: brightness(0.6); object-fit: cover;
        }
        /* ç…™ç«å±¤ (æœ€ä¸Šå±¤) */
        .fireworks-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 999; pointer-events: none; /* è®“é»æ“Šå¯ä»¥ç©¿é€ */
        }
        /* å¡ç‰‡ä¸»é«” */
        .card {
            text-align: center; background: rgba(20, 30, 50, 0.65); padding: 40px; border-radius: 20px;
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); width: 85%; max-width: 450px; position: relative;
            border: 1px solid rgba(255, 255, 255, 0.15); transition: all 0.5s ease;
            z-index: 10; /* ä¿è­‰å¡ç‰‡åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼Œç…™ç«ä¹‹ä¸‹ */
        }
        .hidden { display: none; }
        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
        input { padding: 10px; border-radius: 10px; border: none; width: 60%; margin-bottom: 15px; text-align: center; font-size: 1.2rem; outline: none; background: rgba(255,255,255,0.9); }
        .btn { padding: 12px 25px; border-radius: 50px; border: none; background: var(--accent); color: white; cursor: pointer; font-size: 1rem; transition: 0.3s; margin: 5px; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 77, 109, 0.3); }
        .btn:hover { transform: translateY(-2px) scale(1.05); box-shadow: 0 6px 20px rgba(255, 77, 109, 0.5); }
        /* æ‰“å­—æ©Ÿæ–‡å­—å€ */
        #typing-text { font-size: 1.3rem; line-height: 1.8; margin-bottom: 20px; min-height: 100px; text-align: left; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); }
        #music-control { position: fixed; bottom: 20px; right: 20px; background: rgba(255, 255, 255, 0.2); padding: 10px; border-radius: 50%; cursor: pointer; font-size: 20px; z-index: 100; border: 1px solid rgba(255,255,255,0.3); }

        /* ====================
           å‹•æ…‹æ‹¼æ¥è›‹ç³• CSS
           ==================== */
        .cake-stage {
            position: relative; height: 180px; width: 200px; margin: 20px auto;
            /* æš«æ™‚ç”¨æ–¹å¡Šä»£æ›¿ï¼Œä½ å¯ä»¥æ›æˆåœ–ç‰‡ */
        }
        .cake-part { position: absolute; opacity: 0; /* åˆå§‹ç‹€æ…‹éš±è— */ }

        /* è›‹ç³•åº•éƒ¨ */
        #cake-bottom {
            bottom: 0; left: 10px; width: 180px; height: 60px;
            background: #d68a59; border-radius: 10px 10px 5px 5px; box-shadow: inset 0 -5px rgba(0,0,0,0.1);
        }
        /* è›‹ç³•é ‚éƒ¨ */
        #cake-top {
            bottom: 60px; left: 0; width: 200px; height: 70px;
            background: #ffbcd9; border-radius: 15px 15px 5px 5px; box-shadow: inset 0 -5px rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: flex-end;
        }
        /* è Ÿç‡­èˆ‡ç«ç„° */
        #candle { width: 20px; height: 40px; background: repeating-linear-gradient(45deg, #fff, #fff 5px, #ff4d6d 5px, #ff4d6d 10px); position: relative; bottom: 10px; }
        #flame {
            width: 15px; height: 25px; background: #ffcc00; border-radius: 50% 50% 20% 20%;
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 0 10px #ff6600, 0 0 20px #ffcc00; animation: flicker 0.5s infinite alternate; display: none;
        }

        /* --- å®šç¾©æ‹¼æ¥å‹•ç•« --- */
        /* å¾ä¸‹é¢é£›å…¥ */
        @keyframes assemble-up { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        /* å¾ä¸Šé¢é£›å…¥ */
        @keyframes assemble-down { from { transform: translateY(-100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        /* ç«ç„°é–ƒçˆ */
        @keyframes flicker { from { opacity: 0.8; transform: translateX(-50%) scale(1); } to { opacity: 1; transform: translateX(-50%) scale(1.1); } }

        /* ç•¶æ·»åŠ  .animate class æ™‚è§¸ç™¼å‹•ç•« */
        .animate #cake-bottom { animation: assemble-up 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .animate #cake-top { animation: assemble-down 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.8s forwards; /* å»¶é² 0.8ç§’ */ }
        .animate #candle { animation: assemble-down 0.5s ease-out 1.6s forwards; /* å»¶é² 1.6ç§’ */ }
    </style>
</head>
<body>

    <div class="fireworks-container"></div>

    <video autoplay muted loop playsinline id="bg-video">
        <source src="bgvideo.mp4" type="video/mp4">
    </video>
    <audio id="bgMusic" loop><source src="bgsong.mp3" type="audio/mpeg"></audio>
    <div id="music-control" onclick="toggleMusic()">ğŸµ</div>

    <div id="step1" class="card">
        <h2>ğŸ”’ èº«åˆ†é©—è­‰</h2>
        <p>è«‹è¼¸å…¥é€™ä»½é©šå–œçš„å°ˆå±¬å¯†ç¢¼</p>
        <input type="password" id="pw-input" placeholder="å¯†ç¢¼ 4 ç¢¼">
        <br>
        <button class="btn" onclick="checkPassword()">è§£é–é©šå–œ</button>
    </div>

    <div id="step2" class="card hidden">
        <h2>æˆ‘æƒ³å°å¦³èªª...</h2>
        <div id="typing-text"></div>
        <button id="next-btn" class="btn hidden" onclick="showInteractions()">ç„¶å¾Œå‘¢ï¼Ÿ</button>
    </div>

    <div id="step3" class="card hidden">
        <h1 id="final-title">Happy Birthday!</h1>
        
        <div class="cake-stage" id="cake-stage">
            <div id="cake-bottom" class="cake-part"></div>
            <div id="cake-top" class="cake-part">
                <div id="candle" class="cake-part">
                    <div id="flame"></div>
                </div>
            </div>
        </div>

        <div id="display-area" style="min-height: 40px; font-weight: bold; margin: 10px 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">ç¥å¦³æ–°çš„ä¸€æ­²å¤©å¤©é–‹å¿ƒï¼</div>
        <div class="btn-group">
            <button class="btn" onclick="getCoupon()">æŠ½ç¦®ç‰©åˆ¸</button>
            <button class="btn" id="final-btn" onclick="finalSurprise()">é»ç‡ƒé©šå–œ</button>
        </div>
    </div>

    <script>
        const correctPw = '0121';
        // è¨˜å¾—ä¿®æ”¹é€™è£¡çš„æ–‡å­—
        const heartWords = "é›–ç„¶æˆ‘å€‘é‚„æ²’çœŸæ­£è¦‹éé¢ï¼Œ\nä½†é€™æ®µæ™‚é–“å’Œå¦³èŠå¤©çœŸçš„å¾ˆé–‹å¿ƒã€‚\nåœ¨é€™å€‹ç‰¹åˆ¥çš„æ—¥å­ï¼Œ\næƒ³ç”¨æˆ‘æ­£åœ¨å­¸çš„ç¨‹å¼ï¼Œçµ¦å¦³ä¸€é»ä¸ä¸€æ¨£çš„ç¥ç¦...";
        
        // åˆå§‹åŒ–ç…™ç« (ä¸€é–‹å§‹å…ˆæš«åœ)
        const container = document.querySelector('.fireworks-container');
        const fireworks = new Fireworks.default(container, {
            autoresize: true, opacity: 0.5, acceleration: 1.05, friction: 0.97, gravity: 1.5, particles: 150, traceLength: 3, traceSpeed: 10, explosion: 5, intensity: 30, flickering: 50, lineStyle: 'round',
            hue: { min: 0, max: 360 }, delay: { min: 30, max: 60 }, rocketsPoint: { min: 50, max: 50 }, lineWidth: { explosion: { min: 1, max: 4 }, trace: { min: 1, max: 2 } }, brightness: { min: 50, max: 80 }, decay: { min: 0.015, max: 0.03 }, mouse: { click: false, move: false, max: 1 }
        });

        function checkPassword() {
            const input = document.getElementById('pw-input').value;
            if (input === correctPw) {
                document.getElementById('bgMusic').play().catch(() => {});
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                startTyping();
            } else { alert("å¯†ç¢¼ä¸å°å–”ï¼"); }
        }
        
        // ... (æ‰“å­—æ©Ÿå’ŒéŸ³æ¨‚æ§åˆ¶å‡½å¼èˆ‡ä¹‹å‰ç›¸åŒï¼Œç‚ºç¯€çœç¯‡å¹…çœç•¥ï¼Œè«‹ä½¿ç”¨å®Œæ•´ä»£ç¢¼) ...
        function startTyping(){const area=document.getElementById('typing-text');let i=0;function type(){if(i<heartWords.length){area.innerHTML+=heartWords.charAt(i)==='\n'?'<br>':heartWords.charAt(i);i++;setTimeout(type,100);}else{document.getElementById('next-btn').classList.remove('hidden');}}type();}
        function toggleMusic(){const music=document.getElementById('bgMusic');if(music.paused)music.play();else music.pause();}
        function showInteractions(){document.getElementById('step2').classList.add('hidden');document.getElementById('step3').classList.remove('hidden');}
        function getCoupon(){const coupons=["ã€è¦‹é¢å¤§é¤åˆ¸ã€‘ä¸‹æ¬¡è¦‹é¢æˆ‘è«‹å®¢ï¼ğŸ”","ã€å£å¿ƒæƒ…å‚¾è½åˆ¸ã€‘éš¨å«éš¨åˆ°ï¼ğŸ“","ã€çå¥¶å…Œæ›åˆ¸ã€‘æƒ³å–é£²æ–™éš¨æ™‚é ˜å–ã€‚ğŸ§‹"];document.getElementById('display-area').innerText=coupons[Math.floor(Math.random()*coupons.length)];}

        // --- é—œéµä¿®æ”¹ï¼šæœ€çµ‚é©šå–œè§¸ç™¼ ---
        function finalSurprise() {
            // 1. ä¿®æ”¹æ¨™é¡Œå’ŒæŒ‰éˆ•
            document.getElementById('final-title').innerText = "ğŸ‚ ç”Ÿæ—¥å¿«æ¨‚ï¼ğŸ‚";
            document.getElementById('final-btn').style.display = 'none'; // éš±è—æŒ‰éˆ•
            document.getElementById('display-area').innerText = "è¨±å€‹é¡˜å§ï¼âœ¨";
            
            // 2. å•Ÿå‹•è›‹ç³•æ‹¼æ¥å‹•ç•«
            document.getElementById('cake-stage').classList.add('animate');

            // 3. è Ÿç‡­é»ç‡ƒ (é…åˆå‹•ç•«æ™‚é–“å»¶é²é¡¯ç¤ºç«ç„°)
            setTimeout(() => {
                document.getElementById('flame').style.display = 'block';
                
                // 4. ç«ç„°å‡ºç¾å¾Œï¼Œé–‹å§‹æ”¾ç…™ç«ï¼
                fireworks.start();
                // è®“å¡ç‰‡ç¨å¾®é€æ˜ä¸€é»ï¼Œä»¥ä¾¿æ¬£è³ç…™ç«
                document.querySelector('#step3.card').style.background = 'rgba(20, 30, 50, 0.3)';
            }, 2200); // 2.2ç§’å¾Œè§¸ç™¼ (å› ç‚ºè›‹ç³•å‹•ç•«ç¸½å…±ç´„ 2ç§’)
        }
    </script>
</body>
</html>
