<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç„¡ç›¡æ˜Ÿæ²³ V8 (ç¨ç«‹åˆ†é¡ç‰ˆ)</title>
    <style>
/* ==================== 1. å…¨å±€è¨­å®š ==================== */
        body { 
            margin: 0; background: #050505; overflow: hidden; 
            font-family: 'Microsoft JhengHei', sans-serif; color: white;
            
            /* ğŸ”¥ æ–°å¢é€™å…©è¡Œï¼šç¦æ­¢æ–‡å­—é¸å–ã€å¼·åˆ¶æ»‘é¼ ç‚ºç®­é ­ */
            user-select: none;          /* ç¦æ­¢é¸å–æ–‡å­— (å°±ä¸æœƒå‡ºç¾è¼¸å…¥ç›´ç·šäº†) */
            cursor: default;            /* é è¨­æ»‘é¼ æ¸¸æ¨™ç‚ºç®­é ­ */
            
            /* é‡å°ä¸åŒç€è¦½å™¨çš„ç›¸å®¹æ€§å¯«æ³• (ä¿éšªèµ·è¦‹) */
            -webkit-user-select: none; 
            -moz-user-select: none;
            -ms-user-select: none;
        }

/* ==================== 2. é–‹å ´å€’æ•¸å±¤ (V16 æ¨£å¼) ==================== */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            background: #000;
            overflow: hidden;
            transition: opacity 0.5s;
        }

        /* ç•«å¸ƒ */
        #particle-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            filter: drop-shadow(0 0 10px rgba(232, 214, 181, 0.4)); /* ç±³è‰²å…‰æšˆ */
        }

        /* æŒ‰éˆ•å®¹å™¨ï¼šç½®ä¸­ */
        #start-btn-container {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; flex-direction: column; align-items: center;
            z-index: 4000;
        }

        /* å·è»¸åœ–ç¤º */
        #scroll-icon {
            font-size: 8rem; margin-bottom: 30px;
            filter: drop-shadow(0 0 20px #ffd700);
            animation: floatScroll 3s ease-in-out infinite;
        }
        @keyframes floatScroll {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* æŒ‰éˆ•æœ¬é«” */
        #start-btn {
            padding: 15px 40px; font-size: 1.5rem; letter-spacing: 3px; font-weight: bold;
            color: #e8d6b5; background: rgba(0, 0, 0, 0.6);
            border: 2px solid #e8d6b5; border-radius: 10px;
            cursor: pointer; transition: 0.3s;
            box-shadow: 0 0 15px rgba(232, 214, 181, 0.2);
        }
        #start-btn:hover {
            background: #e8d6b5; color: #000;
            box-shadow: 0 0 50px #e8d6b5; transform: scale(1.05);
        }

        /* ä¸­æ–‡ç‹€æ…‹è¨Šæ¯ (å•Ÿå‹•ä¸­/å®Œæˆ) */
        #status-message {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem; font-weight: bold; color: #fff;
            text-shadow: 0 0 20px #ffd700;
            letter-spacing: 5px;
            display: none; /* åˆå§‹éš±è— */
            z-index: 20;
            font-family: 'Microsoft JhengHei', sans-serif;
            white-space: nowrap;
        }
        
        /* ç‹€æ…‹æ–‡å­—å‹•ç•«ï¼šå‘¼å¸ */
        .status-pulse { animation: textPulse 1.5s infinite alternate; }
        @keyframes textPulse { from { opacity: 0.6; } to { opacity: 1; text-shadow: 0 0 40px #ffd700; } }

        /* è½‰å ´ç™½å…‰ */
        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 10000; opacity: 0; pointer-events: none;
        }
        .flash-bang { animation: flashOut 2.5s ease-out forwards; }
        @keyframes flashOut { 0% { opacity: 1; } 100% { opacity: 0; } }
/* ==================== 3. èƒŒæ™¯èˆ‡å®‡å®™ (è±ªè¯å‡ç´šç‰ˆ) ==================== */
        
        /* åŸºç¤æ·±ç©ºå±¤ (æœ€åº•å±¤) */
        #bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /*ä»¥æ­¤ç‚ºåº•ï¼Œç–ŠåŠ å¤šå±¤æ¼¸å±¤ç‡Ÿé€ æ·±é‚ƒæ„Ÿ */
            background: linear-gradient(to bottom, #020111 0%, #191621 100%);
            z-index: 0;
            overflow: hidden;
        }

        /* æ˜Ÿé›²å±¤ (å¢åŠ å¤¢å¹»è‰²å½©) */
        .nebula-cloud {
            position: absolute;
            width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(62, 28, 168, 0.2), transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 222, 0.15), transparent 30%),
                radial-gradient(circle at 50% 50%, rgba(0, 240, 255, 0.1), transparent 50%);
            filter: blur(20px);
            animation: nebula-move 20s ease-in-out infinite alternate;
        }

        @keyframes nebula-move {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        /* èƒŒæ™¯æ˜Ÿæ˜Ÿ (ç”± JS ç”Ÿæˆï¼Œåˆ†ç‚ºä¸‰ç¨®å°ºå¯¸) */
        .bg-star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle var(--duration) ease-in-out infinite;
        }

        /* æ˜Ÿæ˜Ÿå°ºå¯¸è®ŠåŒ– */
        .bg-star.small { width: 1px; height: 1px; opacity: 0.5; }
        .bg-star.medium { width: 2px; height: 2px; opacity: 0.7; box-shadow: 0 0 2px #fff; }
        .bg-star.large { width: 3px; height: 3px; box-shadow: 0 0 5px #fff, 0 0 10px #00f0ff; }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* å®‡å®™å®¹å™¨ (è² è²¬é‹é¡ï¼Œä¿æŒä¸è®Š) */
        #universe {
            position: absolute; top: 0; left: 0; width: 100%;
            transform: translateY(0); 
            transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1);
            z-index: 10; will-change: transform;
        }

        /* ç•«å¸ƒ (ä¿æŒä¸è®Š) */
        #line-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }

/* ==================== 4. æ˜Ÿæ˜Ÿç¯€é» (V17 ç§‘å¹»è¡Œæ˜Ÿç‰ˆ) ==================== */
        
        /* æ˜Ÿæ˜Ÿå®¹å™¨ (å®šä½ç”¨ï¼Œæœ¬èº«ä¸ç•«æ±è¥¿) */
        .star-node {
            position: absolute;
            width: 40px; height: 40px; /* å®¹å™¨ç¨å¾®å¤§ä¸€é»ï¼Œæ”¾å…‰ç’° */
            transform: translate(-50%, -50%);
            z-index: 20;
            display: flex; justify-content: center; align-items: center;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* 1. æ˜Ÿæ˜Ÿæ ¸å¿ƒ (å¯¦é«”ç™¼å…‰çƒ) */
        .star-core {
            position: absolute;
            width: 12px; height: 12px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(0, 240, 255, 0.6);
            z-index: 2;
            animation: starPulse 3s infinite ease-in-out;
        }

        /* 2. è»Œé“å…‰ç’° (æ—‹è½‰çš„åœˆåœˆ) */
        .star-ring {
            position: absolute;
            width: 30px; height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-top: 1px solid rgba(0, 240, 255, 0.8); /* äº®é‚Š */
            border-bottom: 1px solid rgba(0, 240, 255, 0.3);
            box-shadow: 0 0 5px rgba(0, 240, 255, 0.2);
            z-index: 1;
            animation: starSpin 6s linear infinite;
        }

        /* --- ç‹€æ…‹è®ŠåŒ–ï¼šç•¶è®Šæˆä¸»è§’ (Medium) --- */
        .star-node.medium {
            z-index: 50;
            /* ç¨å¾®æ”¾å¤§å®¹å™¨ï¼Œä½†ä¸åƒä¹‹å‰æ”¾é‚£éº¼å¤§ï¼Œæ”¹ç”¨å…‰æšˆå¼·èª¿ */
            transform: translate(-50%, -50%) scale(2.5); 
        }

        /* ä¸»è§’çš„æ ¸å¿ƒè®Šé‡‘è‰² */
        .star-node.medium .star-core {
            background: #ffd700;
            box-shadow: 0 0 15px #ffd700, 0 0 30px #ffaa00;
        }

        /* ä¸»è§’çš„å…‰ç’°è®Šäº®ä¸”åŠ é€Ÿ */
        .star-node.medium .star-ring {
            border-top-color: #ffd700;
            border-bottom-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
            animation: starSpin 2s linear infinite; /* åŠ é€Ÿæ—‹è½‰ */
            width: 36px; height: 36px; /* å…‰ç’°å¼µé–‹ */
        }

        /* éš±è—ç‹€æ…‹ (è¢«ç…§ç‰‡è¦†è“‹æ™‚) */
        .star-node.hidden {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
        }

        /* --- å‹•ç•«å®šç¾© --- */
        @keyframes starPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.9); opacity: 0.8; }
        }

        @keyframes starSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

/* ==================== 5. ç¨ç«‹ç…§ç‰‡å±¤ (V19 æµé«”æ°´æ™¶ç‰ˆ) ==================== */
        
        #photo-viewer {
            position: fixed; 
            top: 0; left: 0; width: 40px; height: 40px; /* åˆå§‹å°åœ“é» */
            
            border-radius: 50%; 
            background-color: #fff;
            background-size: cover; background-position: center;
            
            /* é£›è¡Œèˆ‡è®Šå½¢éæ¸¡å‹•ç•« */
            transition: all 1.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: center center;
            
            z-index: 900; opacity: 0; pointer-events: none;
            
            /* éš±è—æº¢å‡º (ç‚ºäº†æƒæç·šç‰¹æ•ˆå’Œåœ“è§’) */
            overflow: hidden;
        }

        /* --- ç‹€æ…‹ A: å±•é–‹è‡³è¢å¹•æ­£ä¸­é–“ (å¤§åœ–å±•ç¤º) --- */
        #photo-viewer.center-stage {
            opacity: 1;
            top: 50% !important; left: 50% !important;
            transform: translate(-50%, -50%) scale(1) !important;
            
            /* å°ºå¯¸ */
            width: 65vh !important; height: 65vh !important;
            max-width: 800px; max-height: 800px;
            
            /* ğŸ”¥ã€é—œéµä¿®æ”¹ 1ã€‘å¤–å‹ï¼šæ»‘é †çš„ç¾ä»£åœ“è§’ */
            border-radius: 24px;
            
            /* ğŸ”¥ã€é—œéµä¿®æ”¹ 2ã€‘è³ªæ„Ÿï¼šåˆ©ç”¨å¤šå±¤é™°å½±æ¨¡æ“¬åšå¯¦ç»ç’ƒæ¡† */
            border: none; /* å–æ¶ˆå¯¦é«”é‚Šæ¡† */
            box-shadow: 
                /* ç¬¬1å±¤ï¼šæ·±é‚ƒçš„åº•éƒ¨é™°å½±ï¼Œè£½é€ æ‡¸æµ®æ„Ÿ */
                0 20px 50px rgba(0, 0, 0, 0.8),
                
                /* ç¬¬2å±¤ï¼šå¯¬åšçš„åŠé€æ˜ç‰ç’ƒé‚Šæ¡† (é¡ä¼¼æ‰‹æ©Ÿæ›²é¢å±é‚Šç·£) */
                0 0 0 8px rgba(255, 255, 255, 0.1),
                
                /* ç¬¬3å±¤ï¼šéŠ³åˆ©çš„å…§éƒ¨é«˜å…‰é‚Šç·£ï¼Œå¼·èª¿ç»ç’ƒè³ªæ„Ÿ */
                inset 0 0 0 2px rgba(255, 255, 255, 0.5),
                
                /* ç¬¬4å±¤ï¼šå¤–éƒ¨æŸ”å’Œçš„ç§‘æŠ€è—å…‰æšˆ */
                0 0 40px rgba(0, 240, 255, 0.3);

            /* ç¢ºä¿èƒŒæ™¯åœ–ç‰‡å»¶ä¼¸åˆ°é‚Šç·£ä¸‹é¢ */
            background-clip: border-box;
        }

        /* --- å…¨æ¯æƒæç·šç‰¹æ•ˆ (ä¿ç•™ V18 çš„ç²¾è¯) --- */
        #photo-viewer.center-stage::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(
                to bottom right, 
                transparent 40%, 
                rgba(255, 255, 255, 0.5) 50%, /* æƒæç·šç¨å¾®èª¿äº®ä¸€é» */
                transparent 60%
            );
            transform: rotate(45deg);
            animation: holoScan 3s linear infinite;
            pointer-events: none;
            mix-blend-mode: overlay; /* è®“å…‰ç·šç–ŠåŠ æ›´è‡ªç„¶ */
        }

        @keyframes holoScan {
            0% { transform: rotate(45deg) translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: rotate(45deg) translateY(100%); opacity: 0; }
        }

        /* --- ç‹€æ…‹ B: ç§»åˆ°å·¦é‚Š (3D å´èº«) --- */
        #photo-viewer.move-left {
            left: 28% !important; top: 50% !important;
            width: 55vh !important; height: 55vh !important; 
            
            /* 3D æ—‹è½‰ */
            transform: translate(-50%, -50%) perspective(1000px) rotateY(15deg) !important;
            
            /* å´è½‰æ™‚ï¼Œèª¿æ•´é™°å½±æ–¹å‘ï¼Œæ›´æœ‰ç«‹é«”æ„Ÿ */
            box-shadow: 
                -15px 15px 40px rgba(0, 0, 0, 0.6), /* é™°å½±åå·¦ä¸‹ */
                0 0 0 6px rgba(255, 255, 255, 0.15),
                inset 0 0 0 2px rgba(255, 255, 255, 0.6);
        }

        /* å´è½‰æ™‚æ·¡åŒ–æƒæç·š */
        #photo-viewer.move-left::after { opacity: 0.2; }
/* ==================== 6. ç¨ç«‹æ–‡å­—å¡ç‰‡å±¤ (V22 æœªä¾†ä»‹é¢ç»ç’ƒç‰ˆ) ==================== */
        
        #message-card {
            position: fixed;
            top: 50%; right: 10%; /* æ”¾åœ¨å³é‚Š */
            transform: translateY(-50%) translateX(50px); /* é è¨­å¾€å³åç§»ä¸€é» (é€²å ´ç”¨) */
            
            width: 350px; /* å¡ç‰‡å¯¬åº¦ */
            max-width: 80vw;
            padding: 30px;
            
            /* ğŸ”¥ ç»ç’ƒæ“¬æ…‹èƒŒæ™¯ */
            background: rgba(16, 24, 35, 0.75); /* æ·±è—ç°åŠé€æ˜ */
            backdrop-filter: blur(15px);        /* ç£¨ç ‚æ¨¡ç³Šæ•ˆæœ */
            
            /* é‚Šæ¡†èˆ‡åœ“è§’ */
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1); /* å¾®å¼±ç™½é‚Š */
            border-left: 4px solid #00f0ff; /* ğŸ”¥ å·¦å´é’è‰²äº®æ¢ (å¼·èª¿é‡é») */
            
            /* é™°å½± */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            
            /* å­—é«”è¨­å®š */
	    color: #eee;
            
            /* ğŸ”¥ã€ä¿®æ”¹é€™è£¡ã€‘åŠ å…¥æ¨™æ¥·é«” */
            /* 'DFKai-SB' æ˜¯æ¨™æ¥·é«”çš„æ¨™æº–åç¨±ï¼Œç‚ºäº†ä¿éšªæˆ‘å€‘ä¹Ÿå¯«ä¸­æ–‡ 'æ¨™æ¥·é«”' */
            font-family: 'DFKai-SB', 'BiauKai', 'æ¨™æ¥·é«”', 'Microsoft JhengHei', sans-serif;
            
            /* å»ºè­°ï¼šæ¨™æ¥·é«”é€šå¸¸ç­†ç•«è¼ƒç´°ï¼Œå¯ä»¥ç¨å¾®åŠ ç²—ä¸€é»é»çœ‹èµ·ä¾†æ¯”è¼ƒæ¸…æ¥š */
            font-weight: 500; 
            
            /* æ¨™æ¥·é«”å­—è·ç¨å¾®æ‹‰é–‹ä¸€é»æ›´æœ‰æ–‡è—æ„Ÿ */
            letter-spacing: 2px;
            
            font-size: 1.3rem; /* å­—ä¹Ÿå¯ä»¥ç¨å¾®èª¿å¤§ä¸€é» */
            line-height: 1.8;
            
            /* åˆå§‹ç‹€æ…‹ï¼šéš±è— */
            opacity: 0; pointer-events: none;
            transition: all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            z-index: 850;
        }

        /* --- è£é£¾ï¼šå³ä¸Šè§’çš„ç³»çµ±æ¨™ç±¤ --- */
        #message-card::before {
            content: 'MEMORY_LOG'; /* è£é£¾æ–‡å­— */
            position: absolute;
            top: -10px; right: 20px;
            
            font-size: 0.7rem;
            font-weight: bold;
            color: #00f0ff;
            background: #000; /* é»‘åº•è“‹ä½é‚Šæ¡† */
            padding: 2px 8px;
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 4px;
            letter-spacing: 2px;
        }

        /* --- ç‹€æ…‹ï¼šé¡¯ç¤º (Show) --- */
        #message-card.show {
            opacity: 1; pointer-events: auto;
            transform: translateY(-50%) translateX(0); /* æ»‘å…¥å®šä½ */
        }

        /* --- æ‰“å­—æ©Ÿæ¸¸æ¨™ç‰¹æ•ˆ --- */
        .cursor {
            display: inline-block;
            width: 8px; height: 18px;
            background-color: #00f0ff;
            margin-left: 5px;
            vertical-align: middle;
            animation: cursorBlink 0.8s infinite;
        }

        @keyframes cursorBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* ==================== 7. æ§åˆ¶ä»‹é¢ ==================== */
        #control-panel {
            position: fixed; bottom: 30px; width: 100%; 
            display: flex; justify-content: center; gap: 20px;
            z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 1s;
        }
        #control-panel.show { opacity: 1; pointer-events: auto; }

        .nav-btn {
            padding: 12px 40px; background: rgba(0, 0, 0, 0.5);
            border: 1px solid #fff; color: #fff;
            font-size: 1.2rem; border-radius: 30px;
            cursor: pointer; transition: 0.3s;
        }
        .nav-btn:hover { background: #fff; color: #000; transform: scale(1.05); }

        #progress-bar {
            position: fixed; top: 0; left: 0; height: 3px; width: 0%;
            background: linear-gradient(90deg, #00f0ff, #ff00de);
            z-index: 1000; transition: width 1.5s;
        }
/* ==================== 8é£›è¡Œç‰¹æ•ˆ (V20 æ–°å¢) ==================== */
        
        /* ç•¶å®‡å®™æ­£åœ¨é£›è¡Œæ™‚çš„ç‹€æ…‹ */
/* ç•¶å®‡å®™æ­£åœ¨é£›è¡Œæ™‚çš„ç‹€æ…‹ */
        #universe.hyperspace {
            transition: transform 1.5s cubic-bezier(0.7, 0, 0.3, 1) !important;
            
            /* âŒ åŸæœ¬çš„å¯«æ³•ï¼šblur(3px) æ˜¯å¡é “å…ƒå…‡ */
            /* filter: blur(3px) brightness(1.5); */

            /* âœ… ä¿®æ”¹å¾Œï¼šåªä¿ç•™äº®åº¦è®ŠåŒ–ï¼Œæ‹¿æ‰ blur */
            filter: brightness(1.3); 
        }
/* ==================== V21 ç…§ç‰‡ç‰¹æ•ˆæ“´å…… ==================== */

        /* 1. é›œè¨Šå¹²æ“¾å‹•ç•« (Glitch) - ç™»å ´æ™‚ç”¨ */
        @keyframes glitch-anim {
            0% { 
                transform: translate(-50%, -50%) scale(1) skew(0deg);
                box-shadow: 0 0 0 rgba(0,0,0,0);
                filter: hue-rotate(0deg);
            }
            20% { 
                transform: translate(-55%, -50%) scale(1.02) skew(10deg);
                box-shadow: -5px 0 0 rgba(255,0,0,0.5), 5px 0 0 rgba(0,255,255,0.5); /* ç´…é’è‰²æ•£ */
                filter: hue-rotate(90deg) contrast(1.5);
            }
            40% { 
                transform: translate(-45%, -50%) scale(0.98) skew(-5deg);
                box-shadow: 5px 0 0 rgba(255,0,0,0.5), -5px 0 0 rgba(0,255,255,0.5);
                filter: hue-rotate(-90deg);
            }
            60% { 
                transform: translate(-50%, -52%) scale(1.05) skew(5deg);
                filter: invert(0.2);
            }
            80% { 
                transform: translate(-52%, -48%) scale(0.95) skew(-2deg);
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) skew(0deg);
                box-shadow: 
                    0 20px 50px rgba(0, 0, 0, 0.8),
                    0 0 0 8px rgba(255, 255, 255, 0.1),
                    inset 0 0 0 2px rgba(255, 255, 255, 0.5),
                    0 0 40px rgba(0, 240, 255, 0.3);
                filter: none;
            }
        }

        /* å¥—ç”¨é›œè¨Šçš„ class */
        .glitch-effect {
            animation: glitch-anim 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
        }

        /* 2. å¾®å¾®æ‡¸æµ®å‘¼å¸å‹•ç•« (Floating) - ç©©å®šå¾Œç”¨ */
        @keyframes float-breath {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
            50% { transform: translate(-50%, -50%) translateY(-10px); } /* ä¸Šä¸‹æµ®å‹• */
        }

        /* å¥—ç”¨æ‡¸æµ®çš„ class */
        .floating-effect {
            animation: float-breath 4s ease-in-out infinite;
        }

/* ==================== 9. Boss æˆ°é¬¥å±¤ (æ–°åŠŸèƒ½) ==================== */
        #boss-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); /* æ·±é»‘èƒŒæ™¯ */
            z-index: 20000; /* æ¯”æ‰€æœ‰æ±è¥¿éƒ½é«˜ */
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s;
        }

        /* è­¦å‘Šæ¨™èª */
        .warning-sign {
            color: #ff3333; font-size: 2.5rem; font-weight: 900;
            border: 4px solid #ff3333; padding: 10px 40px;
            margin-bottom: 50px;
            text-shadow: 0 0 20px #ff0000;
            box-shadow: 0 0 30px #ff0000, inset 0 0 20px #ff0000;
            animation: warnFlash 0.5s infinite alternate;
            letter-spacing: 5px;
        }
        @keyframes warnFlash { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0.5; transform: scale(0.98); } }

        /* Boss æœ¬é«” */
        #boss-avatar {
            font-size: 8rem; cursor: crosshair;
            filter: drop-shadow(0 0 30px #a0f);
            transition: transform 0.1s;
            user-select: none; /* é˜²æ­¢è¢«é¸å– */
        }
        #boss-avatar:active { transform: scale(0.9); } /* é»æ“Šç¸®æ”¾ */
        
        /* å—å‚·å‹•ç•« */
        .boss-hit { animation: shakeBoss 0.3s; filter: brightness(5) drop-shadow(0 0 50px red) !important; }
        @keyframes shakeBoss {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-10px, 10px) rotate(-5deg); }
            50% { transform: translate(10px, -10px) rotate(5deg); }
            75% { transform: translate(-10px, -10px) rotate(-5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* è¡€æ¢ */
        #boss-hp-container {
            width: 300px; height: 20px; border: 2px solid #fff;
            margin-top: 30px; border-radius: 10px; overflow: hidden;
            background: #333;
        }
        #boss-hp-bar {
            width: 100%; height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff8800);
            transition: width 0.2s;
        }

        /* å‚·å®³æ•¸å­— */
        .damage-text {
            position: absolute; color: #fff; font-weight: bold; font-size: 1.5rem;
            pointer-events: none; animation: floatUp 0.8s forwards;
            text-shadow: 0 0 5px red;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.5); }
        }

        /* æç¤ºæ–‡å­— */
        .boss-hint {
            color: #aaa; margin-top: 10px; font-size: 0.9rem; letter-spacing: 2px;
            animation: pulse 1s infinite;
        }
        
        /* åŸæœ¬çš„æŒ‰éˆ•é è¨­éš±è— */
        #start-btn-container { display: none; }

/* ==================== 10. æ‰è½å¯¶ç®± (V3: ç¥è©±ç´šç´°ç¯€ç‰ˆ) ==================== */
        
        #chest-wrapper {
            position: relative; width: 220px; height: 180px; /* å†å¤§ä¸€é» */
            cursor: pointer; z-index: 50; display: none;
            animation: chestDrop 1s cubic-bezier(0.5, -0.5, 0.2, 1.5);
            /* ç¥è©±å…‰æšˆ */
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
        }

        /* å¯¶ç®±ç´‹ç†èˆ‡é€šç”¨è¨­å®š */
        .chest-base, .chest-lid {
            position: absolute; width: 100%;
            /* é«˜ç´šç´…æœ¨ç´‹ç† */
            background: linear-gradient(135deg, #5c2a0d 0%, #8b4513 50%, #5c2a0d 100%);
            border: 4px solid #3e1e09;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.8);
        }

        /* --- ä¸‹åŠéƒ¨ --- */
        .chest-base {
            bottom: 0; height: 65%; border-radius: 0 0 20px 20px;
        }
        /* é‡‘å±¬åŒ…è§’èˆ‡é‰šé‡˜ */
        .chest-base::before {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 20px;
            background: #FFD700; border-radius: 0 0 16px 16px;
            border-top: 2px solid #DAA520;
        }

        /* --- ä¸ŠåŠéƒ¨ (è“‹å­) --- */
        .chest-lid {
            bottom: 63%; height: 45%; border-radius: 20px 20px 0 0;
            transform-origin: bottom center;
            transition: transform 0.6s cubic-bezier(0.4, 2, 0.5, 1);
            z-index: 2;
            /* è“‹å­é ‚éƒ¨çš„å¼§åº¦å…‰æ¾¤ */
            background: linear-gradient(to bottom, #a0522d, #8b4513);
        }

        /* é»ƒé‡‘ç¶å¸¶ (ç›´æ¢) */
        .chest-strap {
            position: absolute; width: 24px; height: 100%; top: 0;
            background: linear-gradient(to right, #B8860B, #FFD700, #B8860B);
            border-left: 1px solid #fff; border-right: 1px solid #000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .chest-strap.left { left: 40px; }
        .chest-strap.right { right: 40px; }
        
        /* é‰šé‡˜ (ç”¨ radial-gradient ç•«åœ“é») */
        .chest-strap::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(#8B4513 15%, transparent 16%);
            background-size: 24px 24px; /* é‰šé‡˜é–“è· */
        }

        /* å‚³èªªé–é ­ */
        .chest-lock {
            position: absolute; top: 100%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px;
            background: radial-gradient(circle at 30% 30%, #fff, #FFD700, #DAA520);
            border: 3px solid #fff; border-radius: 50%;
            box-shadow: 0 0 15px #FFD700, 0 5px 10px rgba(0,0,0,0.5);
            z-index: 5; transition: all 0.3s;
        }
        /* é–å­” */
        .chest-lock::after {
            content: ''; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            width: 12px; height: 18px; background: #3e1e09;
            border-radius: 20px 20px 0 0;
        }

        /* --- é–‹ç®±å‹•ç•« --- */
        #chest-wrapper.opened .chest-lid { transform: rotateX(120deg) translateY(-30px); }
        #chest-wrapper.opened .chest-lock { opacity: 0; transform: translate(-50%, -100px) scale(2); }

        /* å…§éƒ¨çˆ†ç™¼è–å…‰ */
        .chest-godray {
            position: absolute; top: 50%; left: 50%; width: 0; height: 0;
            box-shadow: 0 0 100px 50px #fff;
            z-index: 10; opacity: 0;
        }
        #chest-wrapper.opened .chest-godray { animation: godRayFlash 1s ease-out forwards; }
        @keyframes godRayFlash { 
            0% { opacity: 1; box-shadow: 0 0 50px 20px #fff; } 
            100% { opacity: 0; box-shadow: 0 0 500px 200px #FFD700; } 
        }

        /* ==================== 12. Sç´šé“å…·éå ´å±¤ (æ–°åŠŸèƒ½) ==================== */
        #item-get-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); /* æ·±è‰²èƒŒæ™¯ */
            z-index: 60; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            perspective: 1000px;
        }

        /* å…‰èŠ’æ”¾å°„èƒŒæ™¯ */
        .sunburst {
            position: absolute; width: 200vmax; height: 200vmax;
            background: repeating-conic-gradient(from 0deg, rgba(255, 215, 0, 0.1) 0deg 10deg, transparent 10deg 20deg);
            animation: rotateSun 10s linear infinite;
            z-index: 0; pointer-events: none;
        }
        @keyframes rotateSun { to { transform: rotate(360deg); } }

        /* ç²å¾—æ–‡å­— (ä¸Šæ–¹å°å­—) */
        .get-title {
            font-size: 2rem; color: #fff; letter-spacing: 5px; margin-bottom: 20px;
            opacity: 0; animation: fadeInDown 0.5s 0.2s forwards; z-index: 2;
        }
/* Sç´šé“å…·åç¨±å®¹å™¨ - æ©«å‘æ’ç‰ˆè¨­è¨ˆ */
        .item-name {
            display: flex;
            align-items: baseline;   /* åº•éƒ¨å°é½Šï¼Œæ›´æœ‰è¨­è¨ˆæ„Ÿ */
            justify-content: center; /* æ°´å¹³ç½®ä¸­ */
            gap: 20px;               /* å…©å€‹è©ä¹‹é–“çš„è·é›¢ */
            
            width: 100%;
            
            /* çµ±ä¸€çš„é»ƒé‡‘ç™¼å…‰æ¨£å¼ */
            background: linear-gradient(to bottom, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text; color: transparent;
            filter: drop-shadow(0 0 20px #DAA520);
            
            /* é€²å ´å‹•ç•« (ç¶­æŒåŸæœ¬çš„è¡æ“Šæ„Ÿ) */
            transform: scale(3); opacity: 0;
            animation: slamIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.5s forwards;
            z-index: 2; 
        }

        /* æ’ç‰ˆç´°ç¯€ Aï¼šå‰ç¶´ (å‚³èªªç´š) */
        .name-prefix {
            font-size: 3rem;        /* ç¨å¾®å°ä¸€é» */
            font-weight: 700;
            letter-spacing: 10px;   /* ğŸ”¥ é—œéµï¼šå­—è·æ‹‰é–‹ï¼Œé¡¯å¾—é«˜ç´š */
            margin-right: -10px;    /* ä¿®æ­£ letter-spacing å¸¶ä¾†çš„å³é‚Šè· */
        }

        /* æ’ç‰ˆç´°ç¯€ Bï¼šä¸»å (å›æ†¶å·è»¸) */
        .name-main {
            font-size: 5rem;        /* æœ€å¤§å­— */
            font-weight: 900;
            letter-spacing: 2px;
        }

        /* ğŸ”¥ æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼èª¿æ•´ (é¿å…å­—å¤ªé•·è¶…å‡ºè¢å¹•) */
        @media (max-width: 768px) {
            .item-name { 
                flex-direction: column; /* æ‰‹æ©Ÿè‹¥å¤ªçª„ï¼Œæ”¹å›ç›´æ’æ¯”è¼ƒå¥½çœ‹ï¼Ÿä¸ï¼Œä½ è¦æ±‚æ©«çš„ */
                flex-direction: row;    /* å¼·åˆ¶æ©«æ’ */
                align-items: center;
                gap: 10px;
            }
            /* å¼·åˆ¶ç¸®å°å­—é«”ä»¥å¡å…¥æ‰‹æ©Ÿå¯¬åº¦ */
            .name-prefix { font-size: 4vw; letter-spacing: 3px; margin-right: -3px;}
            .name-main { font-size: 8vw; }
        }




        .rank-badge {
            font-size: 8rem; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg) scale(5);
            color: rgba(255, 255, 255, 0.1); border: 10px solid rgba(255, 255, 255, 0.1);
            padding: 20px; font-weight: 900; opacity: 0;
            animation: stampIn 0.4s cubic-bezier(0.5, 0, 0.75, 0) 1s forwards;
            z-index: 1; pointer-events: none;
        }

        /* é»æ“Šç¹¼çºŒæç¤º */
        .tap-continue {
            margin-top: 50px; font-size: 1.2rem; color: #aaa;
            animation: pulse 1s infinite; opacity: 0;
            animation: fadeIn 1s 2s forwards; z-index: 2;
        }

        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slamIn { from { opacity: 0; transform: scale(3); } to { opacity: 1; transform: scale(1); } }
        @keyframes stampIn { from { opacity: 0; transform: translate(-50%, -50%) rotate(-15deg) scale(5); } to { opacity: 1; transform: translate(-50%, -50%) rotate(-15deg) scale(1.5); } }
        @keyframes fadeIn { to { opacity: 1; } }

        /* éš±è—åŸæœ¬çš„å·è»¸å®¹å™¨ï¼Œç›´åˆ°éå ´çµæŸ */
        #scroll-content { display: none; flex-direction: column; align-items: center; }


/* ==================== 11. Boss é€²éšå‹æ…‹ (æ–°åŠŸèƒ½) ==================== */
        
        /* P2: å·¨å¤§åŒ– Boss */
        .boss-giant {
            transform: scale(2.0) !important; /* è®Šå¤§ */
            filter: drop-shadow(0 0 50px #ff0000) hue-rotate(-50deg) !important; /* è®Šç´…ç™¼å…‰ */
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ç¬ç§»æ™‚çš„æ®˜å½±å‹•ç•« */
        .boss-teleport-anim {
            animation: teleportFade 0.3s forwards;
        }
        @keyframes teleportFade {
            0% { opacity: 1; transform: scale(2.0); }
            50% { opacity: 0.5; transform: scale(0.1) rotate(360deg); }
            100% { opacity: 1; transform: scale(2.0); }
        }

        /* å˜²è«·æ–‡å­—æ¨£å¼ */
        .taunt-text {
            position: absolute;
            color: #ff00ff; font-weight: bold; font-size: 1.5rem;
            pointer-events: none;
            text-shadow: 0 0 10px #000;
            animation: popUp 0.8s forwards;
            white-space: nowrap;
        }
        @keyframes popUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            50% { transform: translateY(-40px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-80px) scale(1); opacity: 0; }
        }

/* ==================== 11. Boss P2: ææ€–ç§»å‹•å‹æ…‹ ==================== */
        
        /* P2: è®Šèº«å¾Œçš„ææ€– Boss */
        .boss-scary {
            position: fixed; /* è®“å®ƒå¯ä»¥è‡ªç”±ç§»å‹• */
            font-size: 12rem !important; /* è®Šå¾—æ›´å¤§ */
            
            /* ææ€–æ¿¾é¡ï¼šè®Šç´…ã€å°æ¯”åŠ å¼·ã€é™°å½± */
            filter: drop-shadow(0 0 30px #ff0000) contrast(1.5) sepia(1) hue-rotate(-50deg);
            
            /* åŠ ä¸ŠæŒçºŒçš„é¡«æŠ–å‹•ç•«ï¼Œçœ‹èµ·ä¾†å¾ˆä¸ç©©å®š */
            animation: scaryShake 0.1s infinite;
            
            /* ç§»å‹•æ™‚çš„æ»‘é †æ„Ÿ (0.6ç§’æ»‘åˆ°æ–°ä½ç½®) */
            transition: top 0.6s ease-in-out, left 0.6s ease-in-out, transform 0.2s;
            
            z-index: 20005;
        }

        /* é¡«æŠ–å‹•ç•« */
        @keyframes scaryShake {
            0% { transform: translate(2px, 2px) rotate(0deg); }
            25% { transform: translate(-2px, -2px) rotate(-2deg); }
            50% { transform: translate(-2px, 2px) rotate(2deg); }
            75% { transform: translate(2px, -2px) rotate(-2deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* å˜²è«·æ–‡å­—æ¨£å¼ (ç¶­æŒä¸è®Š) */
        .taunt-text {
            position: absolute;
            color: #ff00ff; font-weight: bold; font-size: 1.5rem;
            pointer-events: none;
            text-shadow: 0 0 10px #000;
            animation: popUp 0.8s forwards;
            white-space: nowrap;
            z-index: 20010;
        }
        @keyframes popUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            50% { transform: translateY(-40px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-80px) scale(1); opacity: 0; }
        }


/* ==================== 13. å¸¥å“¥ä½œè€…æ•‘æ´ç³»çµ± (æ–°åŠŸèƒ½) ==================== */
        
        /* 1. æ•‘æ´è©¢å•è¦–çª— */
        #help-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00f0ff; box-shadow: 0 0 30px #00f0ff;
            padding: 30px; border-radius: 15px; text-align: center;
            z-index: 30000; display: none; /* åˆå§‹éš±è— */
            flex-direction: column; gap: 20px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #help-modal h2 { margin: 0; color: #fff; font-size: 1.5rem; }
        #help-modal p { margin: 0; color: #aaa; }
        
        .help-btn-group { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        .help-btn {
            padding: 10px 30px; font-size: 1.2rem; cursor: pointer; border: none; border-radius: 5px;
            transition: 0.3s; font-weight: bold;
        }
        .btn-yes { background: #00f0ff; color: #000; box-shadow: 0 0 15px #00f0ff; }
        .btn-yes:hover { transform: scale(1.1); background: #fff; }
        .btn-no { background: #333; color: #fff; }
        .btn-no:hover { background: #555; }

        /* 2. ç«æŸ´äººåŠè– */
        #stickman-hero {
            position: fixed; bottom: 10%; left: -200px; /* åˆå§‹åœ¨ç•«é¢å¤– */
            width: 150px; height: 200px;
            z-index: 29000; pointer-events: none;
            transition: transform 0.2s;
        }
        /* ç«æŸ´äººç¹ªè£½ (SVG é¢¨æ ¼) */
        .stick-head {
            width: 40px; height: 40px; border: 4px solid #fff; border-radius: 50%;
            position: absolute; top: 0; left: 55px;
        }
        .stick-body {
            width: 4px; height: 80px; background: #fff;
            position: absolute; top: 40px; left: 73px;
        }
        .stick-arm-l {
            width: 4px; height: 50px; background: #fff;
            position: absolute; top: 50px; left: 73px;
            transform-origin: top center; transform: rotate(30deg);
        }
        .stick-arm-r { /* æ‹¿åŠçš„æ‰‹ */
            width: 4px; height: 50px; background: #fff;
            position: absolute; top: 50px; left: 73px;
            transform-origin: top center; transform: rotate(-60deg);
            transition: transform 0.1s; /* æ®åŠå‹•ç•«ç”¨ */
        }
        .stick-leg-l {
            width: 4px; height: 60px; background: #fff;
            position: absolute; top: 115px; left: 73px;
            transform-origin: top center; transform: rotate(20deg);
        }
        .stick-leg-r {
            width: 4px; height: 60px; background: #fff;
            position: absolute; top: 115px; left: 73px;
            transform-origin: top center; transform: rotate(-20deg);
        }
        
        /* 3. ç¥åŠ */
        .stick-sword {
            width: 6px; height: 120px; background: linear-gradient(to top, #00f0ff, #fff);
            position: absolute; top: 40px; left: -10px; /* åœ¨å³æ‰‹ä¸Š */
            box-shadow: 0 0 20px #00f0ff;
            transform-origin: bottom center;
            transform: rotate(-30deg); /* åŠçš„è§’åº¦ */
        }

        /* 4. åŠæ°£æ–¬æ“Šç‰¹æ•ˆ */
        .slash-fx {
            position: fixed; top: 50%; left: 50%; width: 120%; height: 5px;
            background: #fff;
            transform: translate(-50%, -50%) rotate(-15deg) scaleX(0);
            box-shadow: 0 0 50px 20px #00f0ff;
            z-index: 29500; opacity: 0; pointer-events: none;
        }
        
        /* æ–¬æ“Šå‹•ç•« */
        @keyframes superSlash {
            0% { transform: translate(-50%, -50%) rotate(-15deg) scaleX(0); opacity: 1; }
            30% { transform: translate(-50%, -50%) rotate(-15deg) scaleX(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(-15deg) scaleX(1); opacity: 0; }
        }

        /* æ®åŠå‹•ä½œ Class */
        #stickman-hero.attacking .stick-arm-r {
            transform: rotate(-160deg); /* æ‰‹èˆ‰é«˜ */
        }
        #stickman-hero.slashing .stick-arm-r {
            transform: rotate(45deg); /* ç”¨åŠ›åŠˆä¸‹ */
            transition: transform 0.05s ease-out;
        }


/* ==================== 12. Sç´šé“å…·éå ´å±¤ (V2: å‚³èªªå¡ç‰‡ç‰ˆ) ==================== */
        #item-get-layer {
            /* (ç¶­æŒåŸæœ¬çš„è¨­å®š) */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); /* èƒŒæ™¯å†æ·±ä¸€é» */
            z-index: 60; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            perspective: 1500px; /* å¢åŠ  3D é€è¦–æ„Ÿ */
        }

        /* èƒŒæ™¯æ”¾å°„å…‰èŠ’ (ç¶­æŒåŸæœ¬) */
        .sunburst {
            position: absolute; width: 200vmax; height: 200vmax;
            background: repeating-conic-gradient(from 0deg, rgba(255, 215, 0, 0.15) 0deg 10deg, transparent 10deg 20deg);
            animation: rotateSun 20s linear infinite; z-index: 0; pointer-events: none;
        }
        @keyframes rotateSun { to { transform: rotate(360deg); } }

        /* ğŸ”¥ å¡ç‰‡ç¸½å®¹å™¨ (è² è²¬å®šä½å’Œé€²å ´å‹•ç•«) */
        .legendary-card-container {
            position: relative;
            width: 320px; height: 480px; /* æ¨™æº–å¡ç‰‡æ¯”ä¾‹ */
            z-index: 10;
            /* å¡ç‰‡æ—‹è½‰é£›å…¥å‹•ç•« */
            animation: cardEntrance 0.8s cubic-bezier(0.2, 0.8, 0.2, 1.2) forwards;
            opacity: 0;
        }

        /* ğŸ”¥ å¡ç‰‡æœ¬é«” */
        .legendary-card {
            width: 100%; height: 100%;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            /* å¼·çƒˆç™¼å…‰ */
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5), 0 0 100px rgba(255, 215, 0, 0.3);
            transform-style: preserve-3d;
        }

        /* 1. å¡ç‰‡å¤–æ¡† (é»ƒé‡‘è³ªæ„Ÿ) */
        .card-frame {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border: 8px solid transparent;
            border-image: linear-gradient(to bottom right, #FFD700, #FFA500, #FFD700, #B8860B) 1;
            border-radius: 20px; /* æ³¨æ„ï¼šborder-image å¯èƒ½æœƒåƒæ‰ radiusï¼Œéœ€è¦é®ç½©è™•ç†ï¼Œé€™è£¡å…ˆç”¨ç°¡å–®æ–¹å¼ */
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude;
            background: linear-gradient(to bottom right, #FFD700, #B8860B);
            z-index: 5;
        }
        /* ç°¡å–®ç‰ˆçš„é»ƒé‡‘é‚Šæ¡†æ›¿ä»£æ–¹æ¡ˆ (å¦‚æœä¸Šé¢ mask æœ‰å•é¡Œ) */
        .card-frame::after {
            content: ''; position: absolute; top: -8px; left: -8px; right: -8px; bottom: -8px;
            border-radius: 24px; border: 8px solid #FFD700;
            box-shadow: inset 0 0 20px #B8860B, 0 0 20px #FFD700;
            pointer-events: none; z-index: 5;
        }

        /* 2. å¡ç‰‡å…§éƒ¨èƒŒæ™¯ (é­”æ³•æ˜Ÿç©º) */
        .card-bg {
            position: absolute; top: 4px; left: 4px; right: 4px; bottom: 4px;
            background: linear-gradient(to bottom, #1a0f30, #3a1c71, #d76d77);
            border-radius: 16px;
            z-index: 1;
            overflow: hidden;
        }
        /* èƒŒæ™¯è£¡çš„é­”æ³•ç²’å­ */
        .card-bg::before {
            content: ''; position: absolute; width: 200%; height: 200%;
            background-image: radial-gradient(#fff 1px, transparent 1px), radial-gradient(#FFD700 2px, transparent 2px);
            background-size: 50px 50px, 100px 100px;
            background-position: 0 0, 25px 25px;
            animation: particleMove 10s linear infinite; opacity: 0.5;
        }
        @keyframes particleMove { to { transform: translateY(-50%); } }

        /* 3. å¡ç‰‡å…§å®¹å±¤ */
        .card-content {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            padding: 30px 20px; box-sizing: border-box;
            color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.8);
        }

        /* é ­éƒ¨ï¼šç¨€æœ‰åº¦ */
        .card-header { text-align: center; }
        .rarity-text {
            display: block; font-size: 4rem; font-weight: 900; font-style: italic;
            background: linear-gradient(to right, #FFD700, #fff, #FFD700);
            -webkit-background-clip: text; color: transparent;
            filter: drop-shadow(0 0 10px #FFD700);
        }
        .type-text {
            display: block; font-size: 1.2rem; color: #FFD700; letter-spacing: 5px;
            margin-top: -10px; font-weight: bold;
        }

        /* ä¸­é–“ï¼šåœ–ç¤º */
        .card-icon {
            font-size: 10rem;
            filter: drop-shadow(0 0 30px #FFD700) hue-rotate(-15deg);
            animation: iconFloat 3s ease-in-out infinite alternate;
        }
        @keyframes iconFloat { from { transform: translateY(0); } to { transform: translateY(-20px); } }

        /* åº•éƒ¨ï¼šåç¨± */

        .item-name-card {
            font-size: 2.5rem; font-weight: 900;
            background: linear-gradient(to bottom, #fff, #FFD700);
            -webkit-background-clip: text; color: transparent;
            
            /* ğŸ”¥ ä¿®æ”¹é€™è£¡ï¼šåŸæœ¬æœ‰ border-topï¼Œç¾åœ¨å»æ‰äº†ï¼Œåªç•™ padding */
            padding: 10px 20px;
            /* border-top: 2px solid #FFD700; <--- é€™ä¸€è¡Œè¢«åˆªé™¤äº† */
            
            width: 100%; text-align: center;
            /* å¯ä»¥ç¨å¾®åŠ ä¸€é»é™°å½±è®“æ–‡å­—è·³å‡ºä¾† */
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5)); 
        }

        /* --- å‹•ç•«ç‰¹æ•ˆ --- */

        /* å¡ç‰‡é€²å ´å‹•ç•« (æ—‹è½‰+æ”¾å¤§+å½ˆæ€§) */
        @keyframes cardEntrance {
            0% { opacity: 0; transform: scale(0.2) rotateY(180deg) translateY(100px); }
            60% { opacity: 1; transform: scale(1.1) rotateY(-10deg); }
            100% { opacity: 1; transform: scale(1) rotateY(0deg); }
        }

        /* è¡æ“Šæ³¢ç‰¹æ•ˆ */
        .card-shockwave {
            position: absolute; top: 50%; left: 50%; width: 0; height: 0;
            border-radius: 50%; box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.8);
            animation: shockwave 0.8s ease-out 0.3s forwards; /* å»¶é²æ’­æ”¾ï¼Œé…åˆå¡ç‰‡è½åœ° */
            z-index: 0;
        }
        @keyframes shockwave {
            to { width: 800px; height: 800px; box-shadow: 0 0 100px 50px rgba(255, 215, 0, 0); }
        }

        /* é»æ“Šæç¤º (ç¶­æŒåŸæœ¬) */
        .tap-continue {
            margin-top: 40px; font-size: 1.2rem; color: #aaa;
            animation: pulse 1s infinite; opacity: 0;
            animation: fadeIn 1s 1.5s forwards; z-index: 2;
        }

    </style>
</head>
<body>

<audio id="bgm-boss" loop>
        <source src="boss.mp3" type="audio/mpeg">
    </audio>

    <audio id="bgm-win" loop>
        <source src="win.mp3" type="audio/mpeg">
    </audio>

    <audio id="bgm-countdown" loop>
        <source src="countdown.mp3" type="audio/mpeg">
    </audio>

    <audio id="bgm-galaxy" loop>
        <source src="galaxy.mp3" type="audio/mpeg">
    </audio>

    <audio id="bgm-typing" loop>
        <source src="typing.mp3" type="audio/mpeg">
    </audio>

    <div id="intro-layer">
        <canvas id="particle-canvas"></canvas>

           <div id="item-get-layer" onclick="finishItemGet()">
              <div class="sunburst"></div>
           
               <div class="legendary-card-container">
                <div class="card-shockwave"></div>
                
                <div class="legendary-card">
                    <div class="card-frame"></div>
                    <div class="card-bg"></div>
                    
                    <div class="card-content">
                        <div class="card-header">
                            <span class="rarity-text">S-RANK</span>
                            <span class="type-text">å‚³èªªé“å…·</span>
                        </div>
                        
                        <div class="card-icon">ğŸ“œ</div>
                        
                        <div class="card-footer">
                            <div class="item-name-card">å›æ†¶å·è»¸</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tap-continue">- é»æ“Šä»»æ„è™•é ˜å– -</div>
        </div>

        <div id="boss-layer">
            <div class="warning-sign">âš ï¸ WARNING âš ï¸</div>
            <div style="font-size: 1.2rem; margin-bottom: 20px;">é«˜å¼·åº¦å›æ†¶é«”å‡ºç¾ï¼</div>
            
            <div id="boss-avatar" onclick="hitBoss(event)">ğŸ‘¾</div>
            
            <div id="boss-hp-container">
                <div id="boss-hp-bar"></div>
            </div>
            <div class="boss-hint">>> é»æ“Šæ€ªç‰©é€²è¡Œæ”»æ“Š <<</div>
        </div>

        <div id="start-btn-container">
            <div id="chest-wrapper" onclick="openChest()">
                <div class="chest-lid">
                    <div class="chest-strap left"></div>
                    <div class="chest-strap right"></div>
                    <div class="chest-lock"></div>
                </div>
                <div class="chest-base">
                    <div class="chest-strap left"></div>
                    <div class="chest-strap right"></div>
                </div>
                <div class="chest-godray"></div>
                <div class="chest-hint">âœ¨ é»æ“Šé–‹å•Ÿç¥è©±å¯¶ç®± âœ¨</div>
            </div>

            <div id="scroll-content">
                <div id="scroll-icon">ğŸ“œ</div>
                <button id="start-btn" onclick="startCountdown()">æ‹¾å–å›æ†¶å·è»¸</button>
            </div>
        </div>


        <div id="help-modal">
            <h2>âš ï¸ è‹¦æˆ°è­¦å‘Š âš ï¸</h2>
            <p id="help-text-1">Boss å¤ªå¼·äº†å—ï¼Ÿæ²’é—œä¿‚çš„</p>
            <p id="help-text-2">æ˜¯å¦å¬å–š <b>å¸¥å“¥é˜¿è«¾</b> é€²è¡Œæ”¯æ´ï¼Ÿ</p>
            <div class="help-btn-group">
                <button class="help-btn btn-yes" onclick="summonAuthor()">æ˜¯ï¼Œæ•‘æ•‘æˆ‘ï¼</button>
                <button class="help-btn btn-no" onclick="rejectHelp()">å¦ï¼Œæˆ‘è‡ªå·±ä¾†</button>
            </div>
        </div>

        <div id="stickman-hero">
            <div class="stick-head"></div>
            <div class="stick-body"></div>
            <div class="stick-arm-l"></div>
            <div class="stick-arm-r">
                <div class="stick-sword"></div>
            </div>
            <div class="stick-leg-l"></div>
            <div class="stick-leg-r"></div>
        </div>
        
        <div id="slash-layer" class="slash-fx"></div>



        <div id="status-message"></div>
    </div>
    
    <div id="flash-overlay"></div>
    
    <div id="progress-bar"></div>

    <div id="bg-layer">
        <div class="nebula-cloud"></div>
    </div>

    <div id="universe">
        <canvas id="line-canvas"></canvas>
        <div id="stars-container"></div>
    </div>

    <div id="photo-viewer"></div>

    <div id="message-card">
        <div id="typewriter-text"></div>
    </div>

    <div id="control-panel">
        <button id="next-btn" class="nav-btn" onclick="nextStep()"> å‡ºç™¼ ğŸš€ </button>
    </div>

    <script>
        // ==========================================
        // è³‡æ–™è¨­å®šå€
        // ==========================================
        const photoData = [
            { text: "åŸæœ¬åªæ˜¯æƒ³ä¾†ä¸€å ´æ­²æœˆéœå¥½çš„ç™»å±±ä¹‹æ—…ï¼Œäº«å—ä¸€ä¸‹é¢¨æ™¯ï¼ŒçµæœåŠè·¯æ®ºå‡ºé€™å€‹è—è‰²ä¸æ˜ç”Ÿç‰©ï¼ğŸ˜‚è«‹å•æ‰‹è£¡é‚£æ ¹é¡è‰²è©­ç•°çš„ã€Œè—è‰²é¦™è•‰çš®ã€åˆ°åº•æ˜¯æƒ³æ€æ¨£å•¦ï¼Ÿä¸ç®¡æˆ‘å¾€å±±ä¸Šçˆ¬é‚„æ˜¯å¾€å±±ä¸‹è·‘ï¼Œå›é ­éƒ½èƒ½çœ‹åˆ°ä»–æ‹¿è‘—é¦™è•‰ã€é ‚è‘—é‚£å¼µè¬ä¹‹å‘†èŒçš„è‡‰ç·Šè¿½ä¸æ¨ã€‚é€™å¹´é ­çˆ¬å€‹å±±éƒ½è¦è¢«é¦™è•‰æ€ªå®¢è·Ÿè¹¤ï¼Œæˆ‘å¿ƒå¥½ç´¯...èª°å¿«ä¾†æŠŠé€™éš»é ˜èµ°ï¼ğŸ†˜ğŸŒ  ", src: "photo1.png" },
            { text: "æˆ‘çœŸçš„è¦è¢«å¦³çš„è§’è‰²çµ¦ç¬‘æ­»ï¼Œé€™å¼µç…§ç‰‡å¿…é ˆæ°¸ä¹…å°å­˜ï¼ğŸ“¸è«‹å•é€™ä½èœ‚é†«å¤§å…µï¼Œå¦³ç¾åœ¨æ˜¯åœ¨é€²è¡Œä»€éº¼æ·±å¥§çš„äººç”Ÿå“²å­¸æ€è€ƒå—ï¼Ÿåœ¨é€™ç¨®éš¨æ™‚æœƒè¢«ç‹™æ“Šçš„å®¤å…§ï¼Œå¦³ç«Ÿç„¶èƒ½éœ²å‡ºé€™ç¨®ã€Œçœ‹é€ä¸–ä¿—ã€ç”šè‡³æœ‰é»æƒ³ç¡ã€çš„è¿·é›¢çœ¼ç¥ã€‚", src: "photo2.png" }, 
	    { text: "é›–ç„¶æˆ‘ä¹ŸçŸ¥é“é€™æ¢éš§é“æ˜¯å®‰å…¨çš„ï¼Œä¸ç”¨æ“”å¿ƒå¯¦é«”è¡å‡ºä¾†å’¬äººï¼Œä½†é€™ä¸ä»£è¡¨å¦³å¯ä»¥åœ¨é€™è£¡é–‹å€‹äººæ”å½±å±•æ¬¸ï¼ğŸ˜‚ å¦³çœ‹å¦³é‚£å€‹è‚¢é«”èªè¨€ï¼Œå®Œå…¨å°±æ˜¯ä¸€å‰¯ã€Œçµ‚æ–¼ä¾†åˆ°çŸ¥åæ‰“å¡æ™¯é»ã€çš„éŠå®¢æ¨£ã€‚", src: "photo3.png" },
	    { text: "å¦³ä¸è¦çœ‹ç…§ç‰‡å°±èªªæˆ‘æ²’åšäº‹ï¼æˆ‘å¿ƒè£¡ä¹Ÿæ˜¯å¾ˆç´¯çš„å¥½å—ï¼ğŸ˜¤å¦³çœ‹ç•«é¢è£¡ï¼Œå¦³åœ¨å‰é¢å¥®åŠ›åˆ’èˆ¹ï¼Œæˆ‘åœ¨å¾Œé¢æ‹¿è‘—å·§å…‹åŠ›æ£’ï¼Œä¹çœ‹ä¹‹ä¸‹å¥½åƒæˆ‘æ˜¯è–ªæ°´å°å·ã€‚ä½†å¦³ä¸çŸ¥é“çš„æ˜¯ï¼Œçœ‹è‘—å¦³é‚£ç¨®ã€Œéš¨æ€§æµã€çš„åˆ’èˆ¹æ³•ï¼Œæˆ‘å¿ƒç†å£“åŠ›æœ‰å¤šå¤§ï¼", src: "photo4.png" },
	    { text: "æˆ‘ç™¼èª“ï¼æˆ‘çœŸçš„åªæ˜¯æ€•ç¤¦å‘å¤ªå†·ï¼Œæƒ³å¹«å¦³ã€Œå–æš–ã€è€Œå·²ï¼ğŸ”¥å¦³çœ‹é€™å¼µç…§ç‰‡è£¡çš„ç«å…‰å¤šéº¼æº«é¦¨ã€å¤šéº¼è€€çœ¼ï¼ˆï¼Ÿï¼‰ã€‚é›–ç„¶é€™æ˜¯æˆ‘å€‘ç¬¬ä¸€æ¬¡ä¸€èµ·ç© Minecraftï¼Œé›–ç„¶æˆ‘æ‰‹è£¡æ‹¿è‘—æ‰“ç«æ©Ÿï¼Œé›–ç„¶å¦³æ•´å€‹äººéƒ½è®Šæˆäº†ä¸€åœ˜ç«çƒ...ä½†è¿™éƒ½æ˜¯ç‚ºäº†å±•ç¾æˆ‘å°éšŠå‹çš„ã€Œç†±æƒ…ã€å•Šï¼", src: "photo5.png" },
	    { text: "å¦³é‚£å€‹ã€Œç¾©ç„¡åé¡§è·³é€²ç«æµ·ã€çš„æ±ºå¿ƒçœŸçš„å¾ˆæ„Ÿäººï¼Œä½†æˆ‘å€‘æ˜¯è¦éé—œå•Šå¤§å§Šï¼çœ‹è‘—å¦³ä¸€ç›´åœ¨é‡ç”Ÿé»å’Œå²©æ¼¿ä¹‹é–“æŠ˜è¿”è·‘ï¼Œæˆ‘çœŸçš„æ‡·ç–‘å¦³æ˜¯ä¸æ˜¯æƒ³æŠŠé€™å¼µåœ°åœ–çš„å²©æ¼¿å–ä¹¾ï¼ŸğŸ†˜ğŸ§±", src: "photo6.png" },
	    { text: "æˆ‘å¼·çƒˆæ‡·ç–‘æˆ‘å€‘å…¥éŒ¯è¡Œäº†ï¼Œæˆ‘å€‘ä¸è©²ä¾†è§£è¬ï¼Œæˆ‘å€‘æ‡‰è©²å»é¦¬æˆ²åœ˜è¡¨æ¼”ç©ºä¸­é£›äººï¼ğŸª", src: "photo7.png" },
	    { text: "æˆ‘åš´é‡æ‡·ç–‘é€™å°å¡è»Šæœ‰è‡ªå·±çš„æƒ³æ³•ï¼ğŸš›", src: "photo8.png" },
		{ text: "é€™ä¹Ÿæ˜¯ä¸€å¼µç…§ç‰‡...", src: "photo9.png" },
	    { text: "é€™æ˜¯ä¸€å¼µç…§ç‰‡...", src: "photo10.png" },
	    { text: "é€™æ˜¯ä¸€å¼µç…§ç‰‡...", src: "photo11.png" },
	    { text: "é€™æ˜¯ä¸€å¼µç…§ç‰‡...", src: "photo12.png" }

        ];

        // ==========================================
        // å…¨å±€è®Šæ•¸
        // ==========================================
        const universe = document.getElementById('universe');
        const container = document.getElementById('stars-container');
        const canvas = document.getElementById('line-canvas');
        const ctx = canvas.getContext('2d');
        const progressBar = document.getElementById('progress-bar');
        const nextBtn = document.getElementById('next-btn');
        const photoViewer = document.getElementById('photo-viewer');
        const messageCard = document.getElementById('message-card');
        const typeText = document.getElementById('typewriter-text');
        const STAR_GAP = 800; 
        const SCREEN_H = window.innerHeight;
        let starPositions = [];
        let currentIndex = -1;
        let isAnimating = false;

        // ========================
        // 1. é–‹å ´å€’æ•¸é‚è¼¯
        // ========================
        let pCtx, pCanvas, pW, pH;
        let jupiterParticles = []; 
        let digitParticles = [];   
        let animationId;
        let pCount = 5; 
        let cachedDigitPoints = {}; 
        const premiumGoldColors = ['#FFD700', '#FDB931', '#FFFACD', '#BF953F', '#FFFFFF'];

        function startCountdown() {
	    switchMusic('bgm-countdown');
            document.getElementById('start-btn-container').style.display = 'none';
            const statusMsg = document.getElementById('status-message');
            const intro = document.getElementById('intro-layer');
            const flash = document.getElementById('flash-overlay');

            initCanvas();
            createJupiter(); 
            
            statusMsg.innerText = "å›æ†¶å·è»¸å•Ÿå‹•ä¸­...";
            statusMsg.style.display = "block";
            statusMsg.classList.add('status-pulse');

            preCalculateDigits();
            animate(); 

            setTimeout(() => {
                statusMsg.style.display = "none";
                statusMsg.classList.remove('status-pulse');
                runCountdownSequence();
            }, 1500);

            async function runCountdownSequence() {
                while (pCount > 0) {
                    useCachedParticles(pCount);
                    await wait(1200);
                    explodeParticles();
                    await wait(600); 
                    pCount--;
                }
                statusMsg.innerText = "å›æ†¶å·è»¸å•Ÿå‹•å®Œæˆ";
                statusMsg.style.display = "block";
                statusMsg.classList.add('status-pulse');
                await wait(1000);
                cancelAnimationFrame(animationId);
                flash.classList.add('flash-bang');
                intro.style.opacity = 0;
                switchMusic(null);
                await wait(500);
                intro.style.display = 'none'; 
                if(typeof initGalaxy === 'function') initGalaxy(); 
                const ctrl = document.getElementById('control-panel');
                if(ctrl) ctrl.classList.add('show');
            }
        }

        function preCalculateDigits() {
            for(let i = 1; i <= 5; i++) {
                const points = performScan(i);
                cachedDigitPoints[i] = points;
            }
        }

        function performScan(text) {
            const points = [];
            const scale = 0.25; 
            const sW = Math.floor(pW * scale);
            const sH = Math.floor(pH * scale);
            const tmpCanvas = document.createElement('canvas');
            const tmpCtx = tmpCanvas.getContext('2d');
            tmpCanvas.width = sW; tmpCanvas.height = sH;
            const fontSize = Math.min(pW, pH) * 0.35 * scale; 
            tmpCtx.font = `900 ${fontSize}px Arial Black`;
            tmpCtx.fillStyle = '#fff';
            tmpCtx.textAlign = 'center';
            tmpCtx.textBaseline = 'middle';
            tmpCtx.fillText(text, sW/2, sH/2);
            const imgData = tmpCtx.getImageData(0, 0, sW, sH).data;
            const gap = 2; 
            for(let y = 0; y < sH; y += gap) {
                for(let x = 0; x < sW; x += gap) {
                    if(imgData[(y * sW + x) * 4 + 3] > 128) {
                        points.push({ x: x / scale, y: y / scale });
                    }
                }
            }
            return points;
        }

        function useCachedParticles(num) {
            const points = cachedDigitPoints[num] || [];
            digitParticles = []; 
            points.forEach(p => {
                const angle = Math.random() * Math.PI * 2;
                const dist = Math.max(pW, pH) * 0.8; 
                const startX = pW/2 + Math.cos(angle) * dist;
                const startY = pH/2 + Math.sin(angle) * dist;
                const color = premiumGoldColors[Math.floor(Math.random() * premiumGoldColors.length)];
                digitParticles.push({
                    x: startX, y: startY, tx: p.x, ty: p.y,
                    vx: 0, vy: 0, size: Math.random() * 3.5 + 1.5,
                    color: color, alpha: 1, isExploding: false,
                    ease: Math.random() * 0.06 + 0.04 
                });
            });
        }

        function explodeParticles() {
            digitParticles.forEach(p => {
                p.isExploding = true;
                const angle = Math.random() * Math.PI * 2;
                const force = (Math.random() * 50 + 50) * (Math.min(pW, pH) / 1000); 
                p.vx = Math.cos(angle) * force;
                p.vy = Math.sin(angle) * force;
            });
        }

        function initCanvas() {
            pCanvas = document.getElementById('particle-canvas');
            pCtx = pCanvas.getContext('2d');
            resize();
            window.addEventListener('resize', resize);
        }

        function resize() {
            pW = pCanvas.width = window.innerWidth;
            pH = pCanvas.height = window.innerHeight;
        }

        function createJupiter() {
            jupiterParticles = [];
            const particleCount = 1800; 
            const radius = Math.min(pW, pH) * 0.28; 
            for (let i = 0; i < particleCount; i++) {
                const theta = Math.random() * Math.PI * 2; 
                const phi = Math.acos((Math.random() * 2) - 1); 
                const yRatio = Math.cos(phi); 
                let color = '#5e4e3e';
                if (yRatio > 0.9) color = '#5e4e3e';
                else if (yRatio > 0.6) color = '#bf9b6b';
                else if (yRatio > 0.4) color = '#e8d6b5';
                else if (yRatio > 0.1) color = '#8c5636';
                else if (yRatio > -0.2) color = '#e8d6b5';
                else if (yRatio > -0.6) color = '#8c5636';
                else color = '#a38466';
                jupiterParticles.push({
                    type: 'planet', theta, phi, radius, color,
                    size: Math.random() * 2 + 0.5, speed: 0.002 + Math.random() * 0.001
                });
            }
            const ringCount = 800;
            const ringInner = radius * 1.3; 
            const ringOuter = radius * 2.3; 
            for(let i = 0; i < ringCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const dist = ringInner + Math.random() * (ringOuter - ringInner);
                const ringColor = Math.random() > 0.6 ? 'rgba(232, 214, 181, 0.7)' : 'rgba(255, 215, 0, 0.3)';
                jupiterParticles.push({
                    type: 'ring', angle, distance: dist, color: ringColor,
                    size: Math.random() * 1.5 + 0.5, speed: 0.001 + Math.random() * 0.002, tilt: 0.35
                });
            }
        }

        function drawJupiter() {
            jupiterParticles.forEach(p => {
                if(p.type === 'planet') {
                    p.theta += p.speed;
                    const x3d = p.radius * Math.sin(p.phi) * Math.cos(p.theta);
                    const y3d = p.radius * Math.cos(p.phi);
                    const z3d = p.radius * Math.sin(p.phi) * Math.sin(p.theta);
                    if(z3d > -p.radius * 0.8) { 
                        const scale = (z3d + p.radius * 2) / (p.radius * 2); 
                        const x2d = pW / 2 + x3d;
                        const y2d = pH / 2 + y3d; 
                        pCtx.beginPath();
                        pCtx.arc(x2d, y2d, p.size * scale, 0, Math.PI * 2);
                        pCtx.fillStyle = p.color;
                        pCtx.fill();
                    }
                } else {
                    p.angle += p.speed;
                    const x3d = p.distance * Math.cos(p.angle);
                    const z3d = p.distance * Math.sin(p.angle);
                    const y3d = z3d * p.tilt;
                    const x2d = pW / 2 + x3d;
                    const y2d = pH / 2 + y3d;
                    pCtx.beginPath();
                    pCtx.arc(x2d, y2d, p.size, 0, Math.PI * 2);
                    pCtx.fillStyle = p.color;
                    pCtx.fill();
                }
            });
        }

        function animate() {
            pCtx.fillStyle = '#000';
            pCtx.fillRect(0, 0, pW, pH);
            drawJupiter(); 
            for (let i = 0; i < digitParticles.length; i++) {
                let p = digitParticles[i];
                if (p.isExploding) {
                    p.x += p.vx; p.y += p.vy;
                    p.vx *= 0.96; p.vy *= 0.96;
                    p.alpha -= 0.015; p.size *= 0.97;   
                } else {
                    p.x += (p.tx - p.x) * p.ease;
                    p.y += (p.ty - p.y) * p.ease;
                }
                if (p.alpha > 0.05) {
                    pCtx.beginPath(); 
                    pCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                    pCtx.fillStyle = p.color;
                    pCtx.globalAlpha = p.alpha; 
                    pCtx.fill();
                    pCtx.globalAlpha = 1; 
                }
            }
            animationId = requestAnimationFrame(animate);
        }

        // ========================
// ========================



        // 9. Boss æˆ°é¬¥é‚è¼¯ (V4: ä¸»å‹•å˜²è«· + å¸¥å“¥ä½œè€…æ”¯æ´ç‰ˆ)
        // ========================
        let bossPhase = 1;         
        let bossHP = 100;          
        let maxHP = 100;
        let p2MaxHP = 300;         
        let clickTimer = null;     
        let isTeleporting = false; 
        let moveInterval = null; 
        
        // ğŸ”¥ æ–°è®Šæ•¸
        let helpTimer = null;      // 30ç§’æ•‘æ´è¨ˆæ™‚å™¨
        let tauntInterval = null;  // ä¸»å‹•å˜²è«·è¨ˆæ™‚å™¨

        const bossLayer = document.getElementById('boss-layer');
        const bossAvatar = document.getElementById('boss-avatar');
        const hpBar = document.getElementById('boss-hp-bar');
        const warningSign = document.querySelector('.warning-sign');
        const bossHint = document.querySelector('.boss-hint');
        const startBtnContainer = document.getElementById('start-btn-container');
        const helpModal = document.getElementById('help-modal');

	function initBossBattle() {
            // ... (åŸæœ¬çš„åˆå§‹åŒ–ä»£ç¢¼) ...
            
            helpModal.style.display = 'none';

            // ğŸ”¥ ä¿®æ”¹é€™è£¡ï¼šç›´æ¥æ’­æ”¾ Boss éŸ³æ¨‚
            switchMusic('bgm-boss');

            // å‚™ç”¨æ–¹æ¡ˆï¼šå¦‚æœç€è¦½å™¨æ“‹ä½è‡ªå‹•æ’­æ”¾ï¼Œå‰‡åœ¨ä½¿ç”¨è€…é»æ“Šä»»æ„è™•æ™‚è£œæ’­
            document.addEventListener('click', function startAudio() {
                const bossBgm = document.getElementById('bgm-boss');
                if(bossBgm && bossBgm.paused && bossHP > 0) {
                    switchMusic('bgm-boss');
                }
                // æ’­äº†ä¹‹å¾Œå°±ç§»é™¤é€™å€‹ç›£è½å™¨ï¼Œé¿å…å¹²æ“¾å¾ŒçºŒ
                document.removeEventListener('click', startAudio);
            }, { once: true });
        }
        
        initBossBattle();

        function hitBoss(e) {

            const bossBgm = document.getElementById('bgm-boss');
            if (bossBgm && bossBgm.paused && bossHP > 0) {
                switchMusic('bgm-boss');
            }

            if(bossHP <= 0 && bossPhase === 2) return;
            if(isTeleporting) return;
            const x = e.clientX; const y = e.clientY;
            if (bossPhase === 1) handlePhase1Damage(x, y);
            else handlePhase2Logic(x, y);
        }

	        function handlePhase2Logic(x, y) {
            // å¦‚æœè¨ˆæ™‚å™¨å­˜åœ¨ï¼Œä»£è¡¨é€™æ˜¯ã€ŒçŸ­æ™‚é–“å…§çš„ç¬¬äºŒä¸‹ã€ -> æˆåŠŸé›™æ“Šï¼
            if (clickTimer) {
                clearTimeout(clickTimer); // æ¸…é™¤è¨ˆæ™‚å™¨
                clickTimer = null;
                
                // é€ æˆå‚·å®³
                const damage = Math.floor(Math.random() * 30) + 20; // P2 å‚·å®³é«˜ä¸€é»
                applyDamage(damage, x, y);
                
                bossHint.innerText = ">> æˆåŠŸé€£æ“Šï¼é€ æˆå‚·å®³ï¼ <<";
                bossHint.style.color = "#ff3333";

                // æª¢æŸ¥æ˜¯å¦æ­»äº¡
                if(bossHP <= 0) {
                    bossDie();
                }

            } else {
                // é€™æ˜¯ã€Œç¬¬ä¸€ä¸‹ã€ï¼Œé–‹å•Ÿè¨ˆæ™‚å™¨ç­‰å¾… 300ms
                // å¦‚æœ 300ms å…§æ²’æœ‰ç¬¬äºŒä¸‹ï¼Œå°±åŸ·è¡Œç¬ç§»
                
                // è¦–è¦ºå›é¥‹ï¼šè¼•å¾®éœ‡å‹•ï¼Œæç¤ºéœ€è¦å†ä¸€æ¬¡
                bossAvatar.style.transform = "scale(2.1)"; 
                setTimeout(() => bossAvatar.style.transform = "scale(2.0)", 100);

                clickTimer = setTimeout(() => {
                    clickTimer = null;
                    // æ™‚é–“åˆ°ï¼Œæ²’é»ç¬¬äºŒä¸‹ -> è§¸ç™¼ç¬ç§»å˜²è«·
                    teleportBoss();
                }, 280); // é€™è£¡è¨­å®šé€£æ“Šåˆ¤å®šæ™‚é–“ï¼Œè¶ŠçŸ­è¶Šé›£
            }
        }

        function handlePhase1Damage(x, y) {
            if(bossHP === maxHP) {
                warningSign.innerText = "æ±‚é¥’æ¨¡å¼";
                warningSign.style.color = "#ffff00";
                warningSign.style.borderColor = "#ffff00";
                bossHint.innerText = "Boss: å“å”·ï¼åˆ¥æ‰“è‡‰ï¼";
            } else {
                const begs = ["é¥’å‘½å•Šï¼", "æˆ‘éŒ¯äº†ï¼", "åˆ¥æ‰“äº†ï¼", "ç—›ç—›ç—›ï¼"];
                showTauntText(x, y, begs[Math.floor(Math.random() * begs.length)], '#fff');
            }
            const damage = Math.floor(Math.random() * 15) + 10;
            applyDamage(damage, x, y);
            if(bossHP <= 0) { bossHP = 0; transformToPhase2(); }
        }

	function transformToPhase2() {
            bossPhase = 2; bossHP = p2MaxHP; 
            warningSign.innerText = "BOSS æš´èµ°ä¸­";
            warningSign.style.color = "#ff0000";
            warningSign.style.borderColor = "#ff0000";
            warningSign.style.animation = "warnFlash 0.1s infinite alternate"; 
            bossAvatar.innerText = "ğŸ‘¹"; 
            bossAvatar.classList.add('boss-scary'); 
            bossHint.innerText = "âš ï¸ é–å®šç›®æ¨™ï¼šè«‹å¿«é€Ÿé€£é»å…©ä¸‹ï¼";
            bossHint.style.color = "#00f0ff";
            showTauntText(window.innerWidth/2, window.innerHeight/2, "å¼å–”å–”å–”å–”ï¼ï¼ï¼", "#ff0000");
            updateHPBar();
            
            // é–‹å§‹ç§»å‹•
            startAutoMove();

            // 1. é–‹å§‹ä¸»å‹•å˜²è«·
            tauntInterval = setInterval(() => {
                if(isTeleporting) return;
                const rect = bossAvatar.getBoundingClientRect();
                const activeTaunts = ["æ‰“ä¸åˆ°ï½", "å¤ªæ…¢äº†ï¼", "å°±é€™ï¼Ÿ", "å¥½ç™¢å–”", "æ”¾æ£„å§ï¼"];
                const text = activeTaunts[Math.floor(Math.random() * activeTaunts.length)];
                showTauntText(rect.left + 50, rect.top, text, '#00f0ff');
            }, 2000);

            // ğŸ”¥ 2. é–‹å§‹ 20ç§’ æ•‘æ´å€’æ•¸ (åŸæœ¬æ˜¯30000)
            if(helpTimer) clearTimeout(helpTimer);
            helpTimer = setTimeout(() => {
                if(bossHP > 0) {
                    // ç¢ºä¿æ–‡å­—æ˜¯åˆå§‹ç‹€æ…‹
                    document.getElementById('help-text-1').innerText = "Boss å¤ªå¼·äº†å—ï¼Ÿæ²’é—œä¿‚";
                    document.getElementById('help-text-2').innerText = "æ˜¯å¦å¬å–š å¸¥å“¥ä½œè€… é€²è¡Œæ”¯æ´ï¼Ÿ";
                    helpModal.style.display = 'flex';
                }
            }, 15000); // 15ç§’
        }

// --- æ•‘æ´ç³»çµ±é‚è¼¯ ---

        function closeHelp() {
            helpModal.style.display = 'none';
        }

        // ğŸ”¥ æ–°å¢ï¼šæ‹’çµ•å¹«å¿™çš„é‚è¼¯
        function rejectHelp() {
            // 1. å…ˆé—œé–‰è¦–çª—
            closeHelp();

            // 2. è¨­å®š 10ç§’ å¾Œå†æ¬¡è©¢å•
            if(helpTimer) clearTimeout(helpTimer);
            
            helpTimer = setTimeout(() => {
                // å¦‚æœ Boss é‚„æ´»è‘—ï¼Œå°±å†æ¬¡è·³å‡º
                if(bossHP > 0 && bossPhase === 2) {
                    // ğŸ”¥ æ›´æ”¹æ–‡å­—ï¼šè®Šæˆæ¯”è¼ƒç…©äººçš„è©¢å•
                    document.getElementById('help-text-1').innerText = "çœŸçš„ä¸éœ€è¦å¹«å¿™å—ï¼Ÿ";
                    document.getElementById('help-text-2').innerText = "å¸¥å“¥é˜¿è«¾éš¨æ™‚æº–å‚™å‡ºæ‰‹å–”ï¼";
                    
                    helpModal.style.display = 'flex';
                }
            }, 5000); // 10ç§’å¾Œå†å•ä¸€æ¬¡
        }

        function summonAuthor() {
            closeHelp();
            // æ—¢ç„¶æ¥å—äº†ï¼Œå°±æ¸…é™¤å€’æ•¸è¨ˆæ™‚ï¼Œä¸ç”¨å†å•äº†
            if(helpTimer) clearTimeout(helpTimer);

            // (ä»¥ä¸‹ç¶­æŒåŸæœ¬çš„ç«æŸ´äººå‹•ç•«é‚è¼¯...)
            if(moveInterval) clearInterval(moveInterval);
            if(tauntInterval) clearInterval(tauntInterval);
            
            const hero = document.getElementById('stickman-hero');
            const slash = document.getElementById('slash-layer');
            const bossRect = bossAvatar.getBoundingClientRect();

            hero.style.left = (bossRect.left - 100) + 'px';
            hero.style.top = (bossRect.top + 50) + 'px';
            hero.style.transform = "scale(1)"; 

            setTimeout(() => {
                hero.classList.add('attacking');
                showTauntText(bossRect.left, bossRect.top - 100, "å¸¥å“¥ä½œè€…ï¼šå€Ÿéï¼", "#fff");
            }, 500);

            setTimeout(() => {
                hero.classList.add('slashing'); 
                slash.style.left = (bossRect.left + 100) + 'px';
                slash.style.top = (bossRect.top + 100) + 'px';
                slash.style.animation = "superSlash 0.3s forwards"; 
                
                setTimeout(() => {
                    applyDamage(99999, bossRect.left, bossRect.top);
                    // é€™è£¡ä¸ç”¨ showDamageNumber ä¹Ÿæ²’é—œä¿‚ï¼Œåæ­£éƒ½è¦æ­»äº†
                    bossDie();
                }, 100);

            }, 1000);

            setTimeout(() => {
                hero.style.opacity = 0;
                setTimeout(() => { hero.style.left = "-200px"; hero.style.opacity = 1; }, 500);
            }, 2500);
        }


        function applyDamage(dmg, x, y) {
            bossHP -= dmg;
            if(bossHP < 0) bossHP = 0;
            updateHPBar();
            bossAvatar.classList.remove('boss-hit');
            void bossAvatar.offsetWidth;
            bossAvatar.classList.add('boss-hit');
            if(x && y) showDamageNumber(x, y, dmg);
        }

        function updateHPBar() {
            const currentMax = (bossPhase === 1) ? maxHP : p2MaxHP;
            const hpPercent = (bossHP / currentMax) * 100;
            hpBar.style.width = hpPercent + '%';
        }

        function transformToPhase2() {
            bossPhase = 2; bossHP = p2MaxHP; 
            warningSign.innerText = "BOSS æš´èµ°ä¸­";
            warningSign.style.color = "#ff0000";
            warningSign.style.borderColor = "#ff0000";
            warningSign.style.animation = "warnFlash 0.1s infinite alternate"; 
            bossAvatar.innerText = "ğŸ‘¹"; 
            bossAvatar.classList.add('boss-scary'); 
            bossHint.innerText = "âš ï¸ é–å®šç›®æ¨™ï¼šè«‹å¿«é€Ÿé€£é»å…©ä¸‹ï¼";
            bossHint.style.color = "#00f0ff";
            showTauntText(window.innerWidth/2, window.innerHeight/2, "å¼å–”å–”å–”å–”ï¼ï¼ï¼", "#ff0000");
            updateHPBar();
            
            // é–‹å§‹ç§»å‹•
            startAutoMove();

            // ğŸ”¥ 1. é–‹å§‹ä¸»å‹•å˜²è«· (æ¯ 2 ç§’å—†ä½ ä¸€æ¬¡)
            tauntInterval = setInterval(() => {
                if(isTeleporting) return;
                const rect = bossAvatar.getBoundingClientRect();
                const activeTaunts = ["æ‰“ä¸åˆ°ï½", "å¤ªæ…¢äº†ï¼", "å°±é€™ï¼Ÿ", "å¥½ç™¢å–”", "æ”¾æ£„å§ï¼"];
                const text = activeTaunts[Math.floor(Math.random() * activeTaunts.length)];
                showTauntText(rect.left + 50, rect.top, text, '#00f0ff');
            }, 2000);

            // ğŸ”¥ 2. é–‹å§‹ 30ç§’ æ•‘æ´å€’æ•¸
            helpTimer = setTimeout(() => {
                // å¦‚æœé‚„æ²’æ­»ï¼Œé¡¯ç¤ºæ•‘æ´è¦–çª—
                if(bossHP > 0) {
                    helpModal.style.display = 'flex';
                }
            }, 15000); // 30000 ms = 30ç§’
        }

        function startAutoMove() {
            const rect = bossAvatar.getBoundingClientRect();
            bossAvatar.style.position = 'fixed';
            bossAvatar.style.left = rect.left + 'px';
            bossAvatar.style.top = rect.top + 'px';
            moveInterval = setInterval(() => {
                if(isTeleporting) return; 
                moveBossRandomly();
            }, 800);
        }

        function moveBossRandomly() {
            const padding = 150; 
            const newX = Math.random() * (window.innerWidth - padding * 2) + padding;
            const newY = Math.random() * (window.innerHeight - padding * 2) + padding;
            bossAvatar.style.left = newX + 'px';
            bossAvatar.style.top = newY + 'px';
        }

        function pauseMovementBriefly() {
            if(moveInterval) clearInterval(moveInterval);
            setTimeout(() => {
                if(bossHP > 0) startAutoMove();
            }, 500);
        }

        function teleportBoss() {
            isTeleporting = true;
            // è§¸ç™¼ç¬ç§»æ™‚ï¼Œä¹Ÿç™¼é€å˜²è«·
            const taunts = ["æŠ“ä¸åˆ°ï¼", "å¤ªæ…¢äº†ï¼", "ç¬ç§»ï¼", "å¼±çˆ†äº†"];
            const rect = bossAvatar.getBoundingClientRect();
            showTauntText(rect.left, rect.top, taunts[Math.floor(Math.random() * taunts.length)], '#00f0ff');
            bossAvatar.style.opacity = 0; 
            setTimeout(() => {
                moveBossRandomly(); 
                bossAvatar.style.opacity = 1; 
                isTeleporting = false;
            }, 200);
        }

        function showDamageNumber(x, y, dmg) {
            const el = document.createElement('div');
            el.className = 'damage-text';
            el.innerText = '-' + dmg;
            const randomX = (Math.random() - 0.5) * 40;
            el.style.left = (x + randomX) + 'px';
            el.style.top = (y - 30) + 'px';
            bossLayer.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function showTauntText(x, y, text, color) {
            const el = document.createElement('div');
            el.className = 'taunt-text';
            el.innerText = text;
            el.style.color = color;
            el.style.left = x + 'px';
            el.style.top = (y - 80) + 'px'; 
            bossLayer.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // --- æ•‘æ´ç³»çµ±é‚è¼¯ ---

        function closeHelp() {
            helpModal.style.display = 'none';
        }

        function summonAuthor() {
            closeHelp();
            // æš«åœ Boss å‹•ä½œï¼Œä¹–ä¹–æŒ¨æ‰“
            if(moveInterval) clearInterval(moveInterval);
            if(tauntInterval) clearInterval(tauntInterval);
            
            // 1. ç«æŸ´äººé€²å ´
            const hero = document.getElementById('stickman-hero');
            const slash = document.getElementById('slash-layer');
            const bossRect = bossAvatar.getBoundingClientRect();

            // è¨­å®šç«æŸ´äººä½ç½® (åœ¨ Boss å·¦é‚Š)
            hero.style.left = (bossRect.left - 100) + 'px';
            hero.style.top = (bossRect.top + 50) + 'px';
            hero.style.transform = "scale(1)"; // é¡¯ç¤º

            // 2. è“„åŠ› (èˆ‰æ‰‹)
            setTimeout(() => {
                hero.classList.add('attacking');
                showTauntText(bossRect.left, bossRect.top - 100, "å¸¥å“¥ä½œè€…ï¼šå€Ÿéï¼", "#fff");
            }, 500);

            // 3. æ®åˆ€ + æ–¬æ“Šç‰¹æ•ˆ
            setTimeout(() => {
                hero.classList.add('slashing'); // æ‰‹æ®ä¸‹
                slash.style.left = (bossRect.left + 100) + 'px';
                slash.style.top = (bossRect.top + 100) + 'px';
                slash.style.animation = "superSlash 0.3s forwards"; // æ’­æ”¾åŠæ°£
                
                // 4. Boss çˆ†ç‚¸ (é€ æˆ 99999 å‚·å®³)
                setTimeout(() => {
                    applyDamage(99999, bossRect.left, bossRect.top);
                    showDamageNumber(bossRect.left, bossRect.top, 99999);
                    bossDie();
                }, 100);

            }, 1000);

            // 5. ç«æŸ´äººé€€å ´
            setTimeout(() => {
                hero.style.opacity = 0;
                setTimeout(() => { hero.style.left = "-200px"; hero.style.opacity = 1; }, 500);
            }, 2500);
        }

        function bossDie() {
	    switchMusic('bgm-win');
            // æ¸…é™¤æ‰€æœ‰è¨ˆæ™‚å™¨
            if(moveInterval) clearInterval(moveInterval);
            if(tauntInterval) clearInterval(tauntInterval);
            if(helpTimer) clearTimeout(helpTimer);

            bossAvatar.style.transition = "all 0.5s";
            bossAvatar.style.transform = "scale(0) rotate(180deg)";
            bossAvatar.style.opacity = 0;
            warningSign.innerText = "VICTORY!";
            warningSign.style.borderColor = "#ffd700";
            warningSign.style.color = "#ffd700";
            bossHint.style.display = 'none';
            setTimeout(() => {
                bossLayer.style.opacity = 0;
                setTimeout(() => {
                    bossLayer.style.display = 'none';
                    startBtnContainer.style.display = 'flex';
                    document.getElementById('chest-wrapper').style.display = 'block';
                    document.getElementById('scroll-content').style.display = 'none';
                }, 1000);
            }, 800);
        }



        // ========================
        // 2. åˆå§‹åŒ– Galaxy
        // ========================
        function initGalaxy() {
            const totalHeight = photoData.length * STAR_GAP + SCREEN_H;
            universe.style.height = totalHeight + 'px';
            canvas.width = window.innerWidth;
            canvas.height = totalHeight;

            photoData.forEach((data, i) => {
                const x = window.innerWidth / 2 + Math.sin(i * 1.0) * (window.innerWidth * 0.3);
                const y = window.innerHeight * 0.5 + i * STAR_GAP;
                starPositions.push({ x, y, data, id: i });
                const el = document.createElement('div');
                el.className = 'star-node'; 
                el.style.left = x + 'px';
                el.style.top = y + 'px';
                el.id = `star-${i}`;
                const core = document.createElement('div');
                core.className = 'star-core';
                el.appendChild(core);
                const ring = document.createElement('div');
                ring.className = 'star-ring';
                el.appendChild(ring);
                container.appendChild(el);
            });

            drawStaticPath();
            updateCamera(-1);
        }

async function nextStep() {
            // 1. é˜²å‘†æª¢æŸ¥ï¼šå¦‚æœå‹•ç•«æ­£åœ¨è·‘ï¼Œå°±ä¸è¦é‡è¤‡åŸ·è¡Œ
            if(isAnimating) return;

            // 2. éŸ³æ¨‚é‚è¼¯ï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é»æ“Š (æº–å‚™å‡ºç™¼)ï¼Œæ’­æ”¾æ˜Ÿç©ºéŸ³æ¨‚
            if (currentIndex === -1) {
                switchMusic('bgm-galaxy');
            }

            // 3. é–å®šå‹•ç•«ç‹€æ…‹ (åªå¯«ä¸€æ¬¡å°±å¥½ï¼)
            isAnimating = true;

            // --- ä»¥ä¸‹ç¶­æŒåŸæœ¬é‚è¼¯ ---
            if(currentIndex >= 0) {
                messageCard.classList.remove('show');
                typeText.innerHTML = "";
                photoViewer.classList.remove('move-left');
                await wait(800);
                const oldStar = document.getElementById(`star-${currentIndex}`);
                const rect = oldStar.getBoundingClientRect();
                photoViewer.classList.remove('center-stage');
                photoViewer.style.top = (rect.top + rect.height/2 - 25) + 'px';
                photoViewer.style.left = (rect.left + rect.width/2 - 25) + 'px';
                photoViewer.style.width = '50px';
                photoViewer.style.height = '50px';
                await wait(1000);
                photoViewer.style.opacity = 0;
                oldStar.classList.remove('hidden');
                oldStar.classList.add('medium');
                await wait(50);
                oldStar.classList.remove('medium');
                const nextBtn = document.getElementById('next-btn'); 
                if(nextBtn) {
                    nextBtn.innerText = "ğŸš€ é£›è¡Œä¸­...";
                    nextBtn.style.opacity = 0.5;
                }
                await wait(800);
            }

            const nextIndex = currentIndex + 1;

            // çµæŸè½‰å ´é‚è¼¯
            if(nextIndex >= photoData.length) {
                const nextBtn = document.getElementById('next-btn'); 
                if(nextBtn) {
                    nextBtn.innerText = "âš ï¸ èƒ½é‡è¶…è¼‰...";
                    nextBtn.style.background = "#ff3333";
                    nextBtn.style.borderColor = "#ff3333";
                    nextBtn.style.pointerEvents = 'none';
                }

                const statusMsg = document.getElementById('status-message');
                statusMsg.innerText = "âš ï¸ åµæ¸¬åˆ°å¼·å¤§å£½æ˜Ÿèƒ½é‡ âš ï¸\nç©ºé–“å‚³é€å•Ÿå‹•ä¸­...";
                statusMsg.style.display = "block";
                statusMsg.style.zIndex = "30000"; 
                statusMsg.classList.add('status-pulse');

                const flash = document.getElementById('flash-overlay');
                flash.style.zIndex = "29999"; 
                flash.style.opacity = 1;      
                flash.style.transition = "opacity 2s ease-in"; 

                setTimeout(() => {
                    window.location.href = "test2.html";
                }, 2500);

                isAnimating = false;
                return;
            }

            const universe = document.getElementById('universe');
            universe.classList.add('hyperspace');
            updateCamera(nextIndex);
            
            if(nextIndex > 0) {
                const prevPos = starPositions[nextIndex-1];
                const nextPos = starPositions[nextIndex];
                await animateLine(prevPos, nextPos, 1200); 
            } else {
                await wait(1200);
            }

            universe.classList.remove('hyperspace');
            const targetStar = document.getElementById(`star-${nextIndex}`);
            if(targetStar) {
                targetStar.style.transform = "translate(-50%, -50%) scale(1.5)";
                setTimeout(() => {
                    targetStar.style.transform = "translate(-50%, -50%) scale(1)";
                }, 200);
            }

            const nextStar = document.getElementById(`star-${nextIndex}`);
            const data = photoData[nextIndex];
            nextStar.classList.add('medium');
            await wait(600);

            const rect = nextStar.getBoundingClientRect();
            photoViewer.style.transition = 'none';
            photoViewer.style.top = rect.top + 'px';
            photoViewer.style.left = rect.left + 'px';
            photoViewer.style.width = rect.width + 'px';
            photoViewer.style.height = rect.height + 'px';
            
            if (data.src) {
                photoViewer.style.backgroundImage = `url('${data.src}')`;
                photoViewer.style.backgroundColor = 'transparent'; 
            } else {
                photoViewer.style.backgroundImage = 'none';
                photoViewer.style.backgroundColor = data.color || '#333';
            }
            
            photoViewer.style.opacity = 1; 
            nextStar.classList.add('hidden');
            void photoViewer.offsetWidth; 

            photoViewer.style.transition = 'all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1)';
            photoViewer.classList.add('center-stage');
            
            photoViewer.classList.remove('glitch-effect', 'floating-effect');
            setTimeout(() => {
                photoViewer.classList.add('glitch-effect');
                setTimeout(() => {
                    photoViewer.classList.remove('glitch-effect');
                    if(!photoViewer.classList.contains('move-left')) {
                        photoViewer.classList.add('floating-effect');
                    }
                }, 400); 
            }, 800); 

            await wait(1500);
            photoViewer.classList.remove('floating-effect'); 
            photoViewer.classList.add('move-left');
            await wait(500); 
            messageCard.classList.add('show');
            await wait(800);
            await typeWriterEffect(data.text);

            progressBar.style.width = ((nextIndex + 1) / photoData.length * 100) + "%";
            currentIndex = nextIndex;
            isAnimating = false;
            
            const nextBtn2 = document.getElementById('next-btn');
            if(nextBtn2) {
                nextBtn2.innerText = "ğŸ‘‡ ä¸‹ä¸€å¼µ";
                nextBtn2.style.opacity = 1;
            }
        }
async function typeWriterEffect(text) {
            typeText.innerHTML = '<span class="cursor"></span>'; 
            
            // 1. å–å¾—éŸ³æ•ˆå…ƒç´ 
            const typingSound = document.getElementById('bgm-typing');
            
            // ğŸ”¥ã€é–‹å§‹ã€‘ï¼šåœ¨é€²å…¥è¿´åœˆä¹‹å‰ï¼Œå…ˆé–‹å§‹æ’­æ”¾é•·éŸ³æ•ˆ
            if (typingSound) {
                try {
                    typingSound.currentTime = 0; // ç¢ºä¿å¾é ­é–‹å§‹
                    typingSound.volume = 0.3;    // éŸ³é‡èª¿æ•´
                    await typingSound.play();    // é–‹å§‹æ’­æ”¾
                } catch (e) {
                    // å¿½ç•¥è‡ªå‹•æ’­æ”¾é™åˆ¶çš„éŒ¯èª¤
                    console.log("éŸ³æ•ˆæ’­æ”¾å—é˜»", e);
                }
            }

            // --- æ‰“å­—è¿´åœˆ (é€™è£¡é¢ä¸å†è™•ç†è²éŸ³) ---
            for (let i = 0; i < text.length; i++) {
                const char = text.charAt(i);
                const cursor = typeText.querySelector('.cursor');
                const span = document.createElement('span');
                span.innerText = char;
                typeText.insertBefore(span, cursor);
                
                // æ‰“å­—é€Ÿåº¦
                const speed = Math.random() * 100 + 150;
                await wait(speed);
            }

            // ğŸ”¥ã€çµæŸã€‘ï¼šæ–‡å­—å…¨éƒ¨æ‰“å®Œå¾Œï¼Œç«‹åˆ»åœæ­¢éŸ³æ•ˆ
            if (typingSound) {
                typingSound.pause();         // æš«åœ
                typingSound.currentTime = 0; // æ­¸é›¶ï¼Œæº–å‚™ä¸‹ä¸€æ¬¡ä½¿ç”¨
            }
        }

        function updateCamera(targetIndex) {
            if(targetIndex < 0) targetIndex = 0;
            const targetY = starPositions[targetIndex].y;
            const offset = targetY - (window.innerHeight / 2);
            universe.style.transform = `translateY(-${offset}px)`;
        }

        function drawStaticPath() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.strokeStyle = "rgba(255, 255, 255, 0.1)";
            ctx.lineWidth = 1; ctx.setLineDash([5, 15]); 
            if(starPositions.length > 0) {
                ctx.moveTo(starPositions[0].x, starPositions[0].y);
                for(let i=1; i<starPositions.length; i++) {
                    const prev = starPositions[i-1];
                    const curr = starPositions[i];
                    ctx.bezierCurveTo(prev.x, (prev.y+curr.y)/2, curr.x, (prev.y+curr.y)/2, curr.x, curr.y);
                }
            }
            ctx.stroke();
        }

        function drawActiveLine(p1, p2, progress) {
            const tx = p1.x + (p2.x - p1.x) * progress;
            const ty = p1.y + (p2.y - p1.y) * progress;
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            drawStaticPath(); 
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(tx, ty);
            const gradient = ctx.createLinearGradient(p1.x, p1.y, tx, ty);
            gradient.addColorStop(0, "rgba(0, 240, 255, 0)");   
            gradient.addColorStop(0.5, "rgba(0, 240, 255, 0.8)"); 
            gradient.addColorStop(1, "#ffffff");                 
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 4; ctx.lineCap = 'round'; ctx.stroke();
            ctx.beginPath();
            ctx.arc(tx, ty, 6, 0, Math.PI * 2);
            ctx.fillStyle = "#fff";
            ctx.shadowBlur = 20;
            ctx.shadowColor = "#00f0ff";
            ctx.fill();
            ctx.shadowBlur = 0; 
        }

        function animateLine(p1, p2, duration) {
            return new Promise(resolve => {
                let start = null;
                function step(timestamp) {
                    if (!start) start = timestamp;
                    let p = (timestamp - start) / duration;
                    if (p > 1) p = 1;
                    drawActiveLine(p1, p2, p);
                    if (p < 1) requestAnimationFrame(step);
                    else resolve();
                }
                requestAnimationFrame(step);
            });
        }

        function initBackgroundStars() {
            const bgLayer = document.getElementById('bg-layer');
            const starCount = 100; 
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                const sizeRandom = Math.random();
                if(sizeRandom > 0.9) star.classList.add('bg-star', 'large');
                else if(sizeRandom > 0.6) star.classList.add('bg-star', 'medium');
                else star.classList.add('bg-star', 'small');
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                const duration = 2 + Math.random() * 3;
                star.style.setProperty('--duration', duration + 's');
                star.style.animationDelay = (Math.random() * 5) + 's';
                bgLayer.appendChild(star);
            }
        }
        initBackgroundStars();

        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }


// ========================
        // è£œä¸ï¼šé–‹å¯¶ç®±èˆ‡éå ´å‹•ç•«é‚è¼¯
        // ========================
        function openChest() {
            console.log("å˜—è©¦é–‹å•Ÿå¯¶ç®±..."); 
            
            const chest = document.getElementById('chest-wrapper');
            const itemLayer = document.getElementById('item-get-layer');
            
            // é˜²æ­¢é‡è¤‡é»æ“Š
            if(chest.classList.contains('opened')) return;

            // 1. æ’­æ”¾é–‹ç®±å‹•ç•«
            chest.classList.add('opened');
            chest.style.animation = "shake 0.5s"; // éœ‡å‹•

            // 2. ç­‰å¾…é–‹è“‹ (0.8ç§’)
            setTimeout(() => {
                // é˜²å‘†æ©Ÿåˆ¶ï¼šå¦‚æœéå ´å±¤å­˜åœ¨ï¼Œå°±é¡¯ç¤ºï¼›ä¸å­˜åœ¨å°±ç›´æ¥è·³é
                if (itemLayer) {
                    itemLayer.style.display = 'flex';
                } else {
                    console.warn("æ‰¾ä¸åˆ° item-get-layerï¼Œç›´æ¥è·³è½‰åˆ°å·è»¸");
                    finishItemGet(); // å¼·åˆ¶çµæŸéå ´
                }
                
                // 3. éš±è—å¯¶ç®±
                chest.style.transition = "opacity 0.5s"; 
                chest.style.opacity = 0;
                
                setTimeout(() => {
                    chest.style.display = 'none';
                }, 500);

            }, 800);
        }

        function finishItemGet() {
            const itemLayer = document.getElementById('item-get-layer');
            const scrollContent = document.getElementById('scroll-content');
            
            if(itemLayer) {
                itemLayer.style.transition = "opacity 0.5s";
                itemLayer.style.opacity = 0;
                setTimeout(() => { itemLayer.style.display = 'none'; }, 500);
            }
            
            // é¡¯ç¤ºå·è»¸æŒ‰éˆ•
            if(scrollContent) {
                setTimeout(() => {
                    scrollContent.style.display = 'flex';
                    scrollContent.style.animation = "floatUp 1s ease-out"; 
                }, 500);
            }
        }

        // æ³¨å…¥éœ‡å‹•å‹•ç•«æ¨£å¼ (å¦‚æœ CSS æ²’å¯«åˆ°çš„è©±)
        const shakeStyle = document.createElement("style");
        shakeStyle.innerText = `
            @keyframes shake {
                0%, 100% { transform: rotate(0deg); }
                25% { transform: rotate(-5deg); }
                75% { transform: rotate(5deg); }
            }
        `;
        document.head.appendChild(shakeStyle);



// ==================== éŸ³æ¨‚æ§åˆ¶ç³»çµ± ====================
function switchMusic(playId) {
            // ğŸ”¥ æ›´æ–°æ¸…å–®ï¼šåŠ å…¥ bgm-countdown å’Œ bgm-galaxy
            const audios = ['bgm-boss', 'bgm-win', 'bgm-countdown', 'bgm-galaxy'];
            
            audios.forEach(id => {
                const audio = document.getElementById(id);
                if(audio) {
                    audio.pause();
                    audio.currentTime = 0; 
                }
            });

            if(playId) {
                const target = document.getElementById(playId);
                if(target) {
                    target.volume = 0.5; 
                    target.play().catch(e => console.log("ç­‰å¾…äº’å‹•:", e));
                }
            }
        }

    </script>
</body>

</html>








